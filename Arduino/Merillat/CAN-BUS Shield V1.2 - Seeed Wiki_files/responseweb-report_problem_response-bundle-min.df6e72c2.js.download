var SM=window.SM||{};if(typeof module==="object"&&module.exports){module.exports=SM}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Object={create:function(e){function t(){}t.prototype=e;return new t},hasKeys:function(e,t){var i=t.length,n=0;for(;n<i;n++){if(!(t[n]in e)){throw new Error('key "'+t[n]+'" is missing')}}},toArray:function(e){var t=[],i;for(i in e){t.push(e[i])}return t},equals:function(e,t){var i;if(e===t){return true}if(!(e instanceof Object)||!(t instanceof Object)){return false}if(e.constructor!==t.constructor){return false}for(i in e){if(!e.hasOwnProperty(i)){continue}if(!t.hasOwnProperty(i)){return false}if(e[i]===t[i]){continue}if(typeof e[i]!=="object"){return false}if(!SM.Object.equals(e[i],t[i])){return false}}for(i in t){if(t.hasOwnProperty(i)&&!e.hasOwnProperty(i)){return false}}return true}};if(window.Object.create){SM.Object.create=window.Object.create}if(typeof module==="object"&&module.exports){module.exports=SM.Object}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Array={indexOf:function(e,t){var i,n=e.length;for(i=0;i<n;i++){if(e[i]===t){return i}}return-1},getValue:function(e,t){if(t<0){t=0}else if(t>=e.length){t=e.length-1}return e[t]},sortAscending:function(e,t){var i,n;if(typeof e==="string"){i=e.toLowerCase();n=t.toLowerCase();if(i<n){return 1}else if(i>n){return-1}return 0}return e-t},sortDescending:function(e,t){var i,n;if(typeof e==="string"){i=e.toLowerCase();n=t.toLowerCase();if(i<n){return-1}else if(i>n){return 1}return 0}return t-e},unique:function(e){var t={},i,n,s,o=e.length,r=[];for(i=0;i<o;i++){n=e[i];t[n]=n}for(s in t){r.push(t[s])}return r},addUnique:function(e,t){var i=this.indexOf(e,t);if(i===-1){e.push(t)}},removeItem:function(e,t){var i=this.indexOf(e,t);if(i!==-1){e.splice(i,1)}}};if(typeof module==="object"&&module.exports){module.exports=SM.Array}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.String={r_http_url:/^(https?:\/\/)/,init:function(){this.rtrim=/\S/.test("\xa0")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g},truncate:function(e,t,i){if(!e){return""}if(!t){return e}if(i===undefined){i=true}if(e.length>t){if(i){return e.substring(0,t-3)+"..."}return e.substring(0,t)}return e},endsWith:function(e,t){if(!e||e.length<t.length){return false}return e.substr(e.length-t.length)===t},beginsWith:function(e,t){if(!e||e.length<t.length){return false}return e.substr(0,t.length)===t},afterLast:function(e,t){var i;if(!e){return""}i=e.lastIndexOf(t);if(i===-1){return""}return e.substr(i+1)},beforeFirst:function(e,t){var i;if(!e){return""}i=e.indexOf(t);if(i===-1){return e}return e.substr(0,i)},isHttpUrl:function(e){return this.r_http_url.test(e)},trim:function(){if(String.prototype.trim){return function(e){if(e===null){return""}return String.prototype.trim.call(e)}}return function(e){return e===null?"":e.toString().replace(this.rtrim,"")}}()};SM.String.init();if(typeof module==="object"&&module.exports){module.exports=SM.String}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Math={roundTo:function(e,t){return this._roundTo(e,t,0)},roundPercentageTo:function(e,t){return this._roundTo(e,t,2)},isInt:function(e){if(!isFinite(e)||(typeof e).toLowerCase()!=="number"){return false}return Math.floor(e)===e},toPercentString:function(e,t){if(!isFinite(e)){return"0%"}return""+this.roundPercentageTo(e,t)+"%"},_roundTo:function(e,t,i){var n,s;if(isNaN(e)){return 0}if(e===0){return 0}if(t===undefined){t=1}n=Math.pow(10,t+i)*e;s=Math.pow(10,t);return Math.round(n)/s}};if(typeof module==="object"&&module.exports){module.exports=SM.Math}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./array")}SM.DOM={SPACE:" ",getClass:function(e){return e.className?e.className:""},hasClass:function(e,t){var i,n,s=0,o;if(!e){return false}i=this.getClass(e).split(this.SPACE);n=t.split(this.SPACE);o=n.length;for(;s<o;s++){if(SM.Array.indexOf(i,n[s])!==-1){return true}}return false},removeClass:function(e,t){var i=this.getClass(e).split(this.SPACE),n;if(!e||!t){return}n=SM.Array.indexOf(i,t);if(n!==-1){i.splice(n,1);e.className=i.join(this.SPACE)}},contains:function(e,t){var i=t;while(i){if(i===e){return true}i=i.parentNode}return false},addClass:function(e,t){if(!e||!t){return}if(!this.hasClass(e,t)){e.className=this.getClass(e)+this.SPACE+t}},walkChildren:function(e,t){var i=0,n=e.childNodes,s=n.length,o;for(;i<s;i++){o=n[i];if(o&&o.nodeType===1){t(o)}}},getElementsByClassName:function(e,t){var i,n,s,o=0,r;t=t||document;if(document.getElementsByClassName){return t.getElementsByClassName(e)}n=[];i=t.all?t.all:t.getElementsByTagName("*");r=i.length;for(;o<r;o++){s=i[o];if(this.hasClass(s,e)){n.push(s)}}return n},getCoordinates:function(e,t){var i=0,n=0;do{n+=e.offsetLeft;i+=e.offsetTop;e=e.offsetParent;if(t&&e===t){break}}while(e);return{top:i,left:n}}};if(typeof module==="object"&&module.exports){module.exports=SM.DOM}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Event={normalize:function(e){if(e.srcElement){e.target=e.srcElement}if(!e.preventDefault){e.preventDefault=function(){this.returnValue=false}}if(!e.stopPropagation){e.stopPropagation=function(){this.cancelBubble=true}}return e},add:function(e,t,i){var n="on";if(!e){return}function s(e){e=SM.Event.normalize(e);i(e)}if(e.addEventListener){e.addEventListener(t,s,false)}else if(e.attachEvent){e.attachEvent(n+t,s)}else if(e[n+t]){e[n+t]=s}},BLUR:"blur",CHANGE:"change",CLICK:"click",ENTER_KEYPRESS:"enterkeypress",FOCUS:"focus",FOCUSIN:"focusin",FOCUSOUT:"focusout",KEYDOWN:"keydown",KEYPRESS:"keypress",KEYUP:"keyup",MOUSEDOWN:"mousedown",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEMOVE:"mousemove",MOUSEUP:"mouseup",PASTE:"paste",RESIZE:"resize",SUBMIT:"submit"};if(typeof module==="object"&&module.exports){module.exports=SM.Event}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.KeyCodes={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,CAPS:20,ESCAPE:27,SPACE:32,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,AMPERSAND:55,A:65,C:67,V:86,X:88,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,LESS_THAN:188,GREATER_THAN:190,COMMAND:224,isNonAdditiveKey:function(e){return e===SM.KeyCodes.BACKSPACE||e===SM.KeyCodes.END||e===SM.KeyCodes.HOME||e===SM.KeyCodes.LEFT||e===SM.KeyCodes.UP||e===SM.KeyCodes.RIGHT||e===SM.KeyCodes.DOWN||e===SM.KeyCodes.DELETE},getEscapedHtmlContentCharLength:function(e){switch(e){case SM.KeyCodes.AMPERSAND:return 5;case SM.KeyCodes.LESS_THAN:case SM.KeyCodes.GREATER_THAN:return 4;default:return undefined}}};if(typeof module==="object"&&module.exports){module.exports=SM.KeyCodes}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./object")}SM.Object=$.extend(SM.Object,{deepCopy:function(e){return $.extend(true,{},e)},copy:function(e){return $.extend({},e)},update:function(e,t){$.extend(e,t)},deepUpdate:function(){var e=Array.prototype.concat.apply([true],arguments);return $.extend.apply($,e)},extend:function(){var e=Array.prototype.concat.apply([{}],arguments);return $.extend.apply($,e)},deepExtend:function(){var e=Array.prototype.concat.apply([true,{}],arguments);return $.extend.apply($,e)}});if(typeof module==="object"&&module.exports){module.exports=SM.Object}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.PubSub={$document:$(window.document),subscribe:function(e,t,i){if(!this.on){return this}if(e===null||e===undefined){throw new Error("SM.PubSub: subscribing to a null or undefined event")}if(t===undefined||t===null){throw new Error("SM.PubSub: subscribing to "+e+"without a callback")}if(arguments.length===3){this.$document.on(e,i,t)}else{this.$document.on(e,t)}return this},unsubscribe:function(e,t){if(!this.on){return this}if(e===null||e===undefined){throw new Error("SM.PubSub: unsubscribing to a null or undefined event")}if(arguments.length===2){this.$document.off(e,t)}else{this.$document.off(e)}},publish:function(e){var t={};if(!this.on){return this}if(e===null||e===undefined){throw new Error("SM.PubSub: publishing a null or undefined event")}if(typeof e==="string"){t.type=e}else{if(e.type===null||e.type===undefined){throw new Error("SM.PubSub: publishing a null or undefined event")}t=e}this.$document.trigger(t);return this},time:function(e,t,i){var n,s,o=$.Deferred();if(!this.on){return this}if(arguments.length===3){SM.PubSub.subscribe(e,function(){n=(new Date).getTime()},i);SM.PubSub.subscribe(t,function(e){s=(new Date).getTime()-n;o.notify(s,e)},i)}else{SM.PubSub.subscribe(e,function(){n=(new Date).getTime()});SM.PubSub.subscribe(t,function(e){s=(new Date).getTime()-n;o.notify(s,e)})}return o},on:true};if(typeof module==="object"&&module.exports){module.exports=SM.PubSub}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Widget={__NAME:undefined,__init:undefined,__destroy:undefined,__setters:undefined,__getters:undefined,__counter:0,__defaults:undefined,el:undefined,$el:undefined,__settings:undefined,__uid:undefined,get:function(e,t){var i=this.__getters;if(e===undefined){return undefined}if(i&&i[e]){return i[e](this,t)}return this.__settings[e]},set:function(e,t){var i=this.__setters;if(arguments.length===2){if(i&&i[e]){i[e](this,t)}else{this.__settings[e]=t}}return this},destroy:function(){if(this.__destroy){this.__destroy()}},__$document:$(document),__subscribe:function(e,t,i){if(!i){i={}}if(e===undefined){throw new Error("__subscribe: tried to subscribe to undefined event")}if(t===undefined){throw new Error("__subscribe: subscribing with an undefined callback")}i[this.__NAME]=this;i.self=this;SM.PubSub.subscribe(e+"."+this.__NAME+this.__uid,t,i);return this},__unsubscribe:function(e,t){if(e===undefined){throw new Error("__unsubscribe: tried to unsubscribe to undefined event")}SM.PubSub.unsubscribe(e+"."+this.__NAME+this.__uid,t);return this},__trigger:function(e){var t={};if(e===undefined){throw new Error("__trigger: tried to trigger an undefined event")}if(typeof e==="string"){t.type=this.__NAME+"."+e}else{if(e.type===undefined){throw new Error("__trigger: tried to trigger an undefined event")}t=e;t.type=this.__NAME+"."+e.type}t[this.__NAME]=this;this.$el.trigger(t);return this},subscribe:function(){this.__subscribe.apply(this,arguments);return this},trigger:function(){this.__trigger.apply(this,arguments);return this},unsubscribe:function(){this.__unsubscribe.apply(this,arguments);return this},bind:function(e,t,i){if(arguments.length===2){i=t;if(typeof i!=="function"){throw new Error("bind takes event, delegate, callback or event, callback")}this.$el.on(e,{self:this},i)}else if(arguments.length===3){this.$el.on(e,t,{self:this},i)}else{throw new Error("bind takes event, delegate, callback or event, callback")}return this},__initSettings:function(e){var t,i,n;this.__settings={};if(e){i={};n={};if(this.__defaults){for(t in this.__defaults){if(this.__defaults.hasOwnProperty(t)&&e.hasOwnProperty(t)){n[t]=e[t]}}for(t in e){if(e.hasOwnProperty(t)&&!this.__defaults.hasOwnProperty(t)){i[t]=e[t]}}this.__settings=SM.Object.deepExtend(this.__defaults,n)}else{i=e}SM.Object.update(this.__settings,i)}else if(this.__defaults){this.__settings=SM.Object.deepCopy(this.__defaults)}}};SM.Widgets={register:function(e){e=SM.Object.extend(SM.Widget,e);if(!e.__NAME){throw new Error("the __NAME property must be defined")}e.__counter=0;this._extendjQuery(e);return e},extend:function(e,t){var i=SM.Object.extend(e,t);return this.register(i)},deepExtend:function(e,t){var i=SM.Object.deepExtend(e,t);return this.register(i)},create:function(e,t,i){var n=$.data(t,e.__NAME);if(!n){n=SM.Object.create(e);n.__initSettings(i);n.__uid=e.__counter++;if(e.__counter===1&&e.__setup){e.__setup()}n.el=t;n.$el=$(t);$.data(t,e.__NAME,n);if(i===undefined){i={}}if(e.__init){n.__init(i)}n.$el.on("remove",function(){n.destroy()})}return n},_extendjQuery:function(e){var t=this.create;if($.fn[e.__NAME]){throw new Error("class with this name already exists")}$.fn[e.__NAME]=function(i){function n(n,s){t(e,s,i)}return this.each(n)}}};if(typeof module==="object"&&module.exports){module.exports.Widget=SM.Widget;module.exports.Widgets=SM.Widgets}SM.Touch={TOUCH_BOUNDARY:5,TAP_DELAY:300,_touchCSSEnabled:false,isAndroid:false,init:function(e){this.touchStartCoordinates={x:null,y:null};e.addEventListener("touchstart",this.onTouchStart,false);e.addEventListener("touchend",this.onTouchEnd,false);this.enableTouchSensitiveCSS(e)},isTouchDevice:function(){var e=false;var t=/Chrome\/[.0-9]* Mobile/;if(navigator.userAgent.indexOf("Android")>0){e=/Galaxy Nexus|Nexus/.test(navigator.userAgent);if(t.test(navigator.userAgent)){e=true}}var i=/iP(ad|hone|od)/.test(navigator.userAgent);this.isAndroid=e;return i||e},touchHasMoved:function(e){var t=e.originalEvent.changedTouches[0],i=this.TOUCH_BOUNDARY,n=this.touchStartCoordinates.x,s=this.touchStartCoordinates.y;if(Math.abs(t.clientX-n)>i||Math.abs(t.clientY-s)>i){return true}return false},onTouchStart:function(e){var t=e.touches[0],i=SM.Touch;i.touchStartCoordinates={x:t.clientX,y:t.clientY}},onTouchEnd:function(e){var t=SM.Touch;t.touchStartCoordinates={x:null,y:null};t.lastClickTime=e.timeStamp},enableTouchSensitiveCSS:function(e){$(e).on("touchstart",".touch-sensitive",function(e){$(this).addClass("touchdown")}).on("touchmove",".touch-sensitive",function(e){if(SM.Touch.touchHasMoved(e)){var t=this;$(this).addClass("touchdown-animating-out");$(this).removeClass("touchdown");setTimeout(function(){$(t).removeClass("touchdown-animating-out")},250)}}).on("touchend",".touch-sensitive",function(e){var t=this;$(this).addClass("touchdown-animating-out");$(this).removeClass("touchdown");setTimeout(function(){$(t).removeClass("touchdown-animating-out")},250)});if(this.isAndroid){$(e).on("touchcancel",".touch-sensitive",function(e){var t=this;$(this).addClass("touchdown-animating-out");$(this).removeClass("touchdown");setTimeout(function(){$(t).removeClass("touchdown-animating-out")},250)})}}};SM.SliderQuestion=SM.Widgets.register({__NAME:"sliderQuestion",_POPOUT_LENGTH:253,_ZENKAKU:"\uff10\uff11\uff12\uff13\uff14\uff15\uff16\uff17\uff18\uff19",_INPUT_MAX_LEN:8,_CLEAR_BUTTON_WIDTH:50,_defaultSliderConfig:{min:0,max:100,step:1},__init:function(){this._parseElements()._parseConfiguration()._popoutCheck();if(!this._$sliderWidget.data("slider")){this._detectTextOverflow()._initWidget()._events()._syncResponseFromInput()}},_parseElements:function(){if(!this.$el.hasClass("slider-wrapper")){throw new Error("Slider question failed to initialize.")}this._$sliderWrapper=this.$el.find(".slider-question-wrapper");this._$sliderInput=this.$el.find("input");this._$sliderClear=this.$el.find(".slider-clear");this._$sliderWidget=this._$sliderWrapper.find("[data-slider]");this._$sliderKnob=this._$sliderWidget.find("a");this._$sliderValWarning=this.$el.siblings(".slider-warning");return this},_parseConfiguration:function(){this._min=parseInt(this._$sliderWidget.attr("data-slider-min"),10);this._max=parseInt(this._$sliderWidget.attr("data-slider-max"),10);this._initPos=parseInt(this._$sliderWidget.attr("data-slider-init"),10);this._stepSize=parseInt(this._$sliderWidget.attr("data-slider-step-size"),10);this._questionId=this.$el.closest("[data-question-id]").attr("data-question-id");return this},_popoutCheck:function(){if(this._questionId==="sample_s"){this.$el.parent().addClass("force-mobile");this._isPopout=true}return this},_initWidget:function(){var e=this._initPos!==this._min&&this._initPos!==this._max,t;if(this._isPopout){this._$sliderWidget.width(this._POPOUT_LENGTH);this._$sliderKnob.removeClass("has-response")}this._$sliderWidget.slider({options:{restrictStepSize:false,animateClick:true},constraints:{min:this._min,max:this._max,step:this._stepSize},value:this._initPos!==undefined?this._initPos:this._getMidValue(this._min,this._max)});if(e){t="50%"}else if(this._initPos===this._max){t="100%"}else{t="0"}this.$el.find(".slider-init-bar").css("left",t);this._reset(this);return this},_events:function(){var e=this,t=$("body").hasClass("ie9");this._inputEvent=t?"keyup":"input";this._namespacedResize="resize.slider_"+e._questionId;this._namespacedOrientationchange="orientationchange.slider_"+e._questionId;this.$el.on("slider.change",".slider-question",function(t){e._$sliderKnob.removeClass("dragging");e._handleInput(t,e)}).on("slider.start",".slider-question",function(t){e._$sliderKnob.addClass("has-response");e._handleInput(t,e)}).on("slider.stop",".slider-question",function(t){e._$sliderKnob.removeClass("dragging");e._handleInput(t,e)}).on("slider.slide",".slider-question",function(t){e._$sliderKnob.addClass("dragging");e._updateValue(t)});this._$sliderInput.on("blur",function(t){var i=$(t.target),n=i.val(),s=$.trim(n),o=e._$sliderWidget.data("slider").get("constraints"),r,a;i.val(s);s=e._truncateInput(s);i.val(s);s=e._zenkakuToHankaku(s);if(s===""){e._reset(e)}else if(e._isLegalInput(s)){s=parseInt(s,10);if(o.min<=s&&s<=o.max){a=e._stepSizeAdjustment(s);if(a!==s){s=a;e._adjustedVal=a;e._$sliderValWarning.fadeIn()}else{e._adjustedVal=undefined;e._$sliderValWarning.hide()}if(parseInt(e._$sliderWidget.data("slider").get("value"),10)===s){e._gotResponse(e)}e._$sliderWidget.data("slider").set("value",s);e._$sliderKnob.removeClass("dragging");if(e._adjustedVal!==undefined){i.val(e._adjustedVal)}else{i.val(n)}}else{e._reset(e)}e._$sliderClear.show()}else{e._reset(e);e._$sliderClear.show()}});this._$sliderClear.find("a").on("keypress",function(t){if(t.keyCode===13){e._reset(e,true)}}).on("click",function(){e._reset(e,true)});e._freeze();if(!e._isPopout){$(window).on(e._namespacedResize+","+e._namespacedOrientationchange,function(t,i){if(i&&i==="scroll"){return}var n=e.$el.closest("[data-question-id]").attr("data-question-id"),s=$(".survey-page-body").find("[data-question-id="+n+"]");if(s.length>0){e._updateSliderConfig(e)}else{e._freeze()}})}return this},_syncResponseFromInput:function(){var e=$.trim(this._$sliderInput.val());if(e){if(this._isLegalInput(e)&&this._min<=e&&this._max>=e){e=parseInt(e,10);this._$sliderWidget.data("slider").set("value",e);this._$sliderKnob.removeClass("dragging").addClass("has-response")}this._$sliderClear.show()}return this},_detectTextOverflow:function(){var e;this._$sliderClear.css("opacity",0).show();e=this._$sliderClear[0].scrollWidth;this._$sliderClear.hide().css("opacity",1);if(e>this._CLEAR_BUTTON_WIDTH){this.$el.addClass("slider-clear-overflow")}return this},_getMidValue:function(e,t){return Math.floor(e+(t-e)/2)},_handleInput:function(e,t){this._gotResponse(t);this._updateValue(e)},_updateValue:function(e){var t=$(e.target),i=t.find("a"),n=e.value,s=e.slider.get("value"),o=n!==undefined?n:s,r=$.find("html.auto-scroll").length==1;if((n!==undefined||e.namespace==="start")&&i.hasClass("has-response")){t.closest(".slider-wrapper").find("input").val(o);i.attr("aria-valuenow",o)}if(r){var a=t.closest(".question-row").find("button.new-button");if(a.length>0){a.removeClass("hide")}}},_updateSliderConfig:function(e){var t=e._$sliderKnob.hasClass("has-response"),i=e._$sliderWidget.data("slider").get("constraints");e._$sliderWidget.data("slider").set("constraints",i);if(!t){e._reset(e)}},_gotResponse:function(e){e._$sliderKnob.addClass("has-response");e._$sliderClear.show()},_onResponseCleared:function(e){e._$sliderKnob.removeClass("has-response");e._$sliderValWarning.hide();if($.trim(e._$sliderInput.val())===""){e._$sliderClear.hide()}},_reset:function(e,t){var i=e._$sliderWidget.data("slider").get("constraints"),n=e._$sliderInput.val();if(e._initPos>this._min&e._initPos<this._max){e._$sliderKnob.css("left",e._$sliderWidget.width()/2+"px")}else{e._$sliderWidget.data("slider").set("value",this._initPos)}if(t){e._$sliderInput.val("")}else{e._$sliderInput.val(n)}e._onResponseCleared(e);e._$sliderKnob.removeClass("has-response dragging")},_isLegalInput:function(e){return e.indexOf(".")===-1&&!isNaN(parseInt(e,10))},_freeze:function(){$(window).off(this._namespacedResize+" "+this._namespacedOrientationchange)},_stepSizeAdjustment:function(e){var t=(this._max-this._min)%this._stepSize,i=Math.ceil((this._max-this._min)/this._stepSize),n=Math.floor((e-this._min)/this._stepSize),s=Math.round((e-this._min)/this._stepSize),o=(e-this._min)%this._stepSize,r;if(o>0&&t!==0){if(n===i-1){if(o<t/2){s=n}else{s=i}}}if(s<i){r=s*this._stepSize+this._min}else{r=this._max}return r},_truncateInput:function(e){if(e.length>this._INPUT_MAX_LEN){return e.substr(0,this._INPUT_MAX_LEN)}return e},_zenkakuToHankaku:function(e){var t=e,i=0,n;for(i;i<this._ZENKAKU.length;i++){n=new RegExp(this._ZENKAKU[i],"g");t=t.replace(n,i+"")}return t},deactivate:function(){this._freeze();$(window).off(this._inputEvent);this._$sliderClear.find("a").off("keypress").off("click");this._$sliderWidget.removeData("slider")},get:function(e){if(e==="value"){return this._$sliderInput.val()}}});SM.CheckBox=SM.Widgets.register({__NAME:"checkbox",__init:function(){var e=this.$el.find("input[type=checkbox]");this.$el.on("focusin","input[type=checkbox]",{self:this},this._onFocusin).on("focusout","input[type=checkbox]",{self:this},this._onFocusout);if(SM.Touch.isTouchDevice()){this.$el.on("touchend","label",{self:this},this._onTouchEnd);this.$el.closest("td").on("touchend",{self:this},this._onTouchEnd);this.$el.on("click","input[type=checkbox]",{self:this},this._onClick);this.$el.on("changeOtherAnswerText","input[type=checkbox]",{self:this},this._onChange)}else{this.$el.on("change","input[type=checkbox]",{self:this},this._onChange)}this._setCheckedClass(e)},_onFocusin:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.addClass("focus")},_onFocusout:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.removeClass("focus")},_onChange:function(e){var t=e.data.self,i=$(this);t._setCheckedClass(i)},_onClick:function(e){e.preventDefault();e.stopPropagation();return false},_onTouchEnd:function(e){var t=e.data.self,i=t.$el.find("input[type=checkbox]"),n=t._getLabel(i),s=n.hasClass("checked");if(e.isDefaultPrevented()||typeof n.closest("[data-preset-question]")[0]!=="undefined"){return}e.preventDefault();if(!SM.Touch.touchHasMoved(e)){i.prop("checked",!s);t._setCheckedClass(i)}},_getLabel:function(e){var t=e.attr("id");return this.$el.find("[for="+t+"]")},_setCheckedClass:function(e){var t=this._getLabel(e),i=$.find("html.auto-scroll").length==1;if(e.prop("checked")){t.addClass("checked")}else{t.removeClass("checked")}if(i){var n=e.closest(".question-row").find("button.new-button"),s=e.closest(".question-row").find("input:checked").length;if(n.length>0&&s>0){n.removeClass("hide")}}}});SM.Dropdown=SM.Widgets.register({__NAME:"dropdown",__init:function(){var e=this.$el;this.$el.on("change",null,{self:this},this._onChange)},_onChange:function(e){var t=$(this),i=t.closest("div.question-row"),n=i.find("button.new-button"),s=$.find("article.auto-scroll").length==1;if(s&&!t.find("option[data-other-answer]").prop("selected")&&i.find("div[data-question-type=matrix_menu]").length===0){SM.SurveyPageForm.switchToNextQuestion(t);setTimeout(function(){n.addClass("hide")},100)}else if(n.length>0){n.removeClass("hide")}}});SM.RadioButtonGroup=SM.Widgets.register({__NAME:"radioButtonGroup",__init:function(){var e=this;this.$el.on("focusin","input[type=radio]",{self:this},this._onFocusin).on("focusout","input[type=radio]",{self:this},this._onFocusout).on("change","input[type=radio]",{self:this},this._onChange);if(SM.Touch.isTouchDevice()){this.$el.on("touchend","td:has(label), label",{self:this},this._onTouchEnd)}else{this.$el.on("click","label[data-sm-radio-button-label].checked",{self:this},this._onClick).on("click","td:has(label)",{self:this},this._onCellClick)}this._setCheckedClass(true)},_onFocusin:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.addClass("focus")},_onFocusout:function(e){var t=e.data.self,i=$(this),n=t._getLabel(i);n.removeClass("focus")},_onChange:function(e){var t=e.data.self;t._setCheckedClass();$naRadio=t.$el.find("[data-emoji-na-button] .radio-button-input");if($naRadio.length==1&&$(e.target).is($naRadio)){$currentQuestion=$naRadio.closest(".question-emoji-rating-table");if($currentQuestion.length){$currentQuestion.find(".emoji-rating").removeClass("selected").removeClass("hovered");$currentQuestion.find(".emoji-rating input[type=radio]").prop("checked",false).data("selected",false)}}},_onTouchEnd:function(e){var t=$(this).closest("[data-sm-radio-button]");if(e.isDefaultPrevented()||typeof t.closest("[data-preset-question]")[0]!=="undefined"){return}e.preventDefault();if(!t.length){t=$(this).find("[data-sm-radio-button]")}var i=e.data.self,n=t.find("input[type=radio]"),s=i._getLabel(n),o=i.$el.find(".checked");if(!SM.Touch.touchHasMoved(e)){if(o.length){o.find("input[type=radio]").prop("checked",false)}n.prop("checked",!s.hasClass("checked"));n.trigger("change")}},_onCellClick:function(e){if($(e.target).is("td")){$(this).find("label").click()}},_onClick:function(e){var t=e.data.self,i=$(this),n=i.attr("for"),s=$("#"+n);if(s.prop("checked")&&typeof s.closest("[data-preset-question]")[0]==="undefined"){s.prop("checked",false);s.trigger("change");e.preventDefault()}},_getLabel:function(e){var t=e.attr("id");return this.$el.find("[for="+t+"]")},_setCheckedClass:function(e){var t=this,i,n=$.find("html.auto-scroll").length==1;this.$el.find("input[type=radio]").each(function(s,o){var r=$(this),a=t._getLabel(r);a.removeClass("checked");if(r.prop("checked")){a.addClass("checked");i=r;if(n&&!e){var l=r.closest("div.question-row"),u=l.find("button.new-button"),d=l.find('table.question-matrix-table:not(".question-emoji-rating-table")').length==1,f=r.attr("data-other-answer")!==undefined&&r.attr("data-other-answer")!==false,h=l.find("input[type=radio][data-other-answer]").length>0,c=l.find("input[data-other-text]").length>0||l.find("textarea[data-other-text]").length>0,_=d||f||c&&!h;if(!_){SM.SurveyPageForm.switchToNextQuestion(r)}else{if(u.length>0){showButton=l.find("input:checked").length;if(showButton>0){u.removeClass("hide")}}}}}});if(SM.Touch.isTouchDevice()){this.$el.trigger({type:"radiobuttonchanged",$selected:i})}}});SM.OtherAnswerTextOption=SM.Widgets.register({__NAME:"otherAnswerTextOption",__init:function(e){e=typeof e==="string"?e:"question";var t=this.$el.parents("."+e),i=t.find("[data-other-answer]");if(i.length){this._$answer=i;this._answerTag=i.prop("tagName").toLowerCase();if(this._answerTag==="option"){t.find("select").on("change",{self:this},this._onSelectChange);this._toggleVisibility()}else{i.on("change",{self:this},this._onOtherInputChange)}this.$el.on("keyup paste",{self:this},this._onEdit).on("click touchend",{self:this},this._onClickOrTouch)}},_onEdit:function(e){var t=e.data.self,i=$.trim(t.$el.val());if(!i){return}if(e.type==="keyup"&&e.which===SM.KeyCodes.TAB||e.which===SM.KeyCodes.SHIFT){return}if(t._answerTag==="option"){if(!t._$answer.prop("selected")){t._$answer.prop("selected",true)}}else{if(!t._$answer.prop("checked")){t._$answer.prop("checked",true);t._$answer.trigger("change");t._$answer.trigger("changeOtherAnswerText")}}},_toggleVisibility:function(){var e=!!this._$answer.prop("selected");this.$el.toggle(e);return e},_onSelectChange:function(e){var t=e.data.self;var i=t._toggleVisibility();if(i){t.$el.focus()}},_onOtherInputChange:function(e){var t=e.data.self;if(t._$answer.prop("checked")){t.$el.focus()}},_onClickOrTouch:function(e){var t=e.data.self;if(t._answerTag==="option"){if(!t._$answer.prop("selected")){t._$answer.prop("selected",true)}}else{if(!t._$answer.prop("checked")){t._$answer.prop("checked",true);t._$answer.trigger("change");t._$answer.trigger("changeOtherAnswerText")}}}});SM.ForcedRankingQuestion=SM.Widgets.register({__NAME:"forcedRankingQuestion",__init:function(){this.$el.on("change","input[type=radio]",{self:this},this._onRadioChange)},_onRadioChange:function(e){var t=e.data.self,i,n,s,o,r;i=$(this);if(!i.prop("checked")){return}o=t.$el.find("table tbody tr");n=i.parents("tr");s=n.find("input[type=radio]");r=s.index(i);o.not(n).each(function(){var e=$(this),t=e.find("input[type=radio]"),i=t.eq(r);if(i.prop("checked")){i.prop("checked",false);i.trigger("change")}})}});SM.NpsQuestion=SM.Widgets.register({__NAME:"npsQuestion",NPS_CONTAINER_OFFSET_TOP:7,NPS_CONTAINER_OFFSET_LEFT:8,NPS_POP_UP_PADDING:20,__init:function(){var e=this;if(SM.Touch.isTouchDevice()){this.$el.on("touchstart","label",{self:this},this._onTouchStart).on("touchend","label",{self:this},this._onTouchEnd).on("radiobuttonchanged",{self:this},this._setNpsPressedState)}},_onTouchStart:function(e){var t=e.data.self,i=$(this),n=i.closest(".nps-radio-button-container"),s=n.parents("div.question-matrix-nps-table").find(".nps-pop-up");s.css({width:n.outerWidth()+t.NPS_POP_UP_PADDING,height:n.outerHeight()+t.NPS_POP_UP_PADDING});s.show();s.find(".nps-pop-up-text").text(n.find(".radio-button-display").attr("data-position"));s.offset({top:n.offset().top-t.NPS_CONTAINER_OFFSET_TOP,left:n.offset().left-t.NPS_CONTAINER_OFFSET_LEFT})},_onTouchEnd:function(e){var t=e.data.self,i=$(this).closest(".nps-radio-button-container"),n=i.parents("div.question-matrix-nps-table").find(".nps-pop-up");n.hide()},_setNpsPressedState:function(e){var t=e.data.self;t.$el.find(".nps-radio-button-container").removeClass("nps-pressed-state");if(e.$selected){e.$selected.closest(".nps-radio-button-container").addClass("nps-pressed-state")}}});SM.RankingQuestion=SM.Widgets.register({__NAME:"rankingQuestion",NA_CLASS:"question-ranking-na-rank",NA_LABEL_CLASS:"answer-label-rank-na",NA_LABEL_SELECTOR:".answer-label-rank-na",CHECKBOX_SELECTOR:"input[type=checkbox]",SORTING_CLASS:"question-ranking-sorting",SORTING_PLACEHOLDER_CLASS:"question-ranking-sort-placeholder",SORTING_PLACEHOLDER_SELECTOR:".question-ranking-sort-placeholder",DISABLED_SORTABLE_CLASS:"disable-sortable",DISABLED_SORTABLE_HANDLE_CLASS:"disable-sortable-handle",HANDLE_HOVER_CLASS:"question-ranking-rank-hover",SORTABLE_SELECTOR:".question-ranking-rank-wrapper",DISABLED_SORTABLE_SELECTOR:".disable-sortable",ENABLED_SORTABLE_SELECTOR:".question-ranking-rank-wrapper:not(.disable-sortable)",HANDLE_SELECTOR:".question-ranking-rank",SORTABLES_CONTAINER_SELECTOR:".question-ranking-sortable-container",__init:function(){this._$rankContainer=this.$el.find(this.SORTABLES_CONTAINER_SELECTOR);this._buildRankValueMaps();this._initRankState();this._sortRankElements();this._updateEnabledOptions();this.$el.on("mouseenter",this.HANDLE_SELECTOR,{self:this},this._onMouseenter).on("mouseleave",this.HANDLE_SELECTOR,{self:this},this._onMouseleave).on("mousedown",this.ENABLED_SORTABLE_SELECTOR,{self:this},this._onMousedown).on("change",this.CHECKBOX_SELECTOR,{self:this},this._onNaCheckboxChange).on("change","select",{self:this},this._onSelectChange)},_buildRankValueMaps:function(){var e=this,t={},i={},n=this.$el.find("select").first();n.find("option").each(function(){var e=$(this),n,s=$.trim(e.text()),o;if(s.length){o=parseInt(s,10);if(isNaN(o)){o="na"}n=e.attr("value");t[o]=n;i[n]=o}});this._rankToValue=t;this._valueToRank=i},_initRankState:function(){var e=this,t=this.$el.find(this.SORTABLE_SELECTOR);t.each(function(t,i){var n=$(i),s=n.find("select"),o=n.find(e.CHECKBOX_SELECTOR),r,a;e._syncSelectValue(s);r=s.val();a=r===e._rankToValue.na;o.prop("checked",a);e._updateNAClasses(n,a)})},_sortRankElements:function(){var e=this._buildRankLists(),t=this._sortRankLists(e);this._$rankContainer.append(t)},_buildRankLists:function(){var e=this.$el.find(this.SORTABLE_SELECTOR),t=[],i=[],n=[],s=this;e.each(function(e,o){var r=$(o),a=r.find("select"),l,u;l=a.val();u=l===s._rankToValue.na;r=r.detach();if(u){t.push(r)}else if(l){i.push(r)}else{n.push(r)}});return{naRows:t,rankedRows:i,
unrankedRows:n,allRows:e.get()}},_sortRankLists:function(e){var t,i=this;if(!e.rankedRows.length){t=e.unrankedRows}else if(!e.unrankedRows.length){t=e.rankedRows.sort(function(e,t){var n=i._valueToRank[e.find("select").val()],s=i._valueToRank[t.find("select").val()];return n-s})}else{t=i._sortRankedAndUnrankedRows(e)}if(e.naRows.length){t=t.concat(e.naRows)}return t},_sortRankedAndUnrankedRows:function(e){var t=e.allRows.length-e.naRows.length,i,n,s,o=[];for(s=0;s<t;s++){i=s+1;n=this._getRowElByRank(e,i);if(n){o.push(n)}else{o.push(e.unrankedRows.shift())}}return o},_getRowElByRank:function(e,t){var i=e.rankedRows.length,n,s,o;for(o=0;o<i;o++){n=e.rankedRows[o];s=this._valueToRank[n.find("select").val()];if(s===t){return n}}},_onSelectChange:function(e){var t=e.data.self,i=$(this),n=i.parents(t.SORTABLE_SELECTOR),s=n.find(t.CHECKBOX_SELECTOR),o=t.$el.find("select").not(i),r,a,l,u=i.val(),d=t._valueToRank[u],f=i.attr("data-row-id"),h=t._getRankValueEl(f).val(),c=t._valueToRank[h],_=t._rankToValue.na,p=u===_,g=e.cascade,v=$.find("html.auto-scroll").length==1;s.prop("checked",p);t._updateNAClasses(n,p);t._updateEnabledOptions();if(u&&!p){r=t._findOtherSelectWithValue(i);if(r){if(h===_||!h){l=t._getUnnassignedRanks();g="up";$.each(l,function(e){if(e>d){g="down";return false}})}if(t._dragOffset!==undefined){if(g==="down"){a=t._rankToValue[d+1]}else if(g==="up"){a=t._rankToValue[d-1]}else if(c<d){a=t._rankToValue[d-1];g="up"}else if(c>d){a=t._rankToValue[d+1];g="down"}r.val(a).trigger({type:"change",cascade:g})}else{a=t._rankToValue[c];r.val("").trigger("change")}}}else if(p){o.each(function(e,i){var n=$(i),s=n.val(),o,r;if(s&&s!==_){r=t._valueToRank[s];if(c<r){o=t._rankToValue[r-1];n.val(o);t._syncHiddenValue(n)}}else if(s===null){o=t._rankToValue[t._lowestRank];n.val(o);t._syncHiddenValue(n)}})}if(v){var m=i.closest("div.question-row"),b=m.find("button.new-button");if(b.length>0){b.removeClass("hide")}}t._syncHiddenValue(i)},_onNaCheckboxChange:function(e){var t=e.data.self,i=$(this),n=i.is(":checked"),s=i.parents(t.SORTABLE_SELECTOR),o=s.find("select");if(n){o.val(t._rankToValue.na).trigger("change")}else{t._rankPosition(s)}t._sortRankElements();t._rankPositions()},_onMouseenter:function(e){var t=e.data.self;$(this).addClass(t.HANDLE_HOVER_CLASS)},_onMouseleave:function(e){var t=e.data.self;$(this).removeClass(t.HANDLE_HOVER_CLASS)},_getAssignedRanks:function(){var e=this,t={};this.$el.find("select").each(function(i,n){var s=$(n),o=s.val(),r=e._valueToRank[o];if(r&&r!=="na"){t[r]=true}});return t},_getUnnassignedRanks:function(){var e={},t=this,i=this._getAssignedRanks();$.each(this._rankToValue,function(n){if(!i[n]&&n!=="na"&&n<=t._lowestRank){e[n]=true}});return e},_findOtherSelectWithValue:function(e){var t=e.val(),i;this.$el.find("select").not(e).each(function(e,n){if($(n).val()===t){i=$(n);return false}});return i},_updateNAClasses:function(e,t){var i=e.find(this.HANDLE_SELECTOR);if(t){i.addClass(this.DISABLED_SORTABLE_HANDLE_CLASS).addClass(this.NA_CLASS);e.addClass(this.DISABLED_SORTABLE_CLASS)}else{i.removeClass(this.DISABLED_SORTABLE_HANDLE_CLASS).removeClass(this.NA_CLASS);e.removeClass(this.DISABLED_SORTABLE_CLASS)}},_updateEnabledOptions:function(){var e=this.$el.find(this.DISABLED_SORTABLE_SELECTOR).length,t,i=this;this.$el.find(this.SORTABLE_SELECTOR).each(function(){var t=$(this),n=t.find("select"),s=t.find(i.CHECKBOX_SELECTOR),o,r=s.prop("checked"),a,l=n.children("option");l.prop("disabled",false);o=-1-e;if(r){o++}l.slice(o,-1).prop("disabled",true)});this._setLowestRank()},_setLowestRank:function(){var e=this,t=this.$el.find(this.ENABLED_SORTABLE_SELECTOR).first(),i,n;n=t.find("option").filter(function(t){var i=$(this),n=i.attr("value"),s=e._valueToRank[n];return!i.prop("disabled")&&s!=="na"}).last();i=this._valueToRank[n.attr("value")];e._lowestRank=i},_syncHiddenValue:function(e){var t=e.attr("data-row-id");this._getRankValueEl(t).val(e.val())},_syncSelectValue:function(e){var t=e.attr("data-row-id");e.val(this._getRankValueEl(t).val())},_getRankValueEl:function(e){return this.$el.find("input[data-row-id="+e+"]")},_onMousedown:function(e){var t=$(this),i=$(e.target),n=e.data.self,s=e.pageY-t.offset().top,o=n.$el.find(n.ENABLED_SORTABLE_SELECTOR);if(i.is("select")||i.is("option")||i.hasClass(n.NA_LABEL_CLASS)||i.parents(n.NA_LABEL_SELECTOR).length){return}n._setupDrag(t,s);e.preventDefault()},_onGlobalMousemove:function(e){var t=e.data.rankingQuestion,i=e.data.$rank,n;if(!t._isSorting){t._startSort(i)}n=t._moveRank(i,e.pageY);if(n!==undefined&&t._placeholderIndex!==n){t._movePlaceholder(n)}},_onGlobalMouseup:function(e){var t=e.data.rankingQuestion,i=e.data.$rank;if(t._isSorting){t._stopSort(i)}t._teardownDrag()},_setupDrag:function(e,t){this.ondragstart=function(){return false};document.onselectstart=function(){return false};this.subscribe("mousemove",this._onGlobalMousemove,{$rank:e}).subscribe("mouseup",this._onGlobalMouseup,{$rank:e});this._dragOffset=t},_startSort:function(e){var t;this._isSorting=true;this._sortRankElements();t=e.clone();t.addClass(this.SORTING_PLACEHOLDER_CLASS);t.insertAfter(e);this._$rankContainer.prepend(e);e.addClass(this.SORTING_CLASS);this._buildRankTops();this._placeholderIndex=t.index();this.trigger("startSort")},_moveRank:function(e,t){var i=this._$rankContainer.offset().top,n=this._$rankContainer.outerHeight(),s=n+i,o=t-this._dragOffset-i,r=e.outerHeight(),a=r+o;if(a>n){e.css("top",n-r)}else if(o<0){e.css("top",0)}else{e.css("top",o)}return this._rankTops[Math.ceil(o)]},_stopSort:function(e){var t=this;this._isSorting=false;e.removeClass(this.SORTING_CLASS);e.css("top","auto");this.$el.find(this.SORTING_PLACEHOLDER_SELECTOR).replaceWith(e);this._rankPosition(e);this._sortRankElements();t._rankPositions();this.trigger("stopSort")},_teardownDrag:function(){this.unsubscribe("mousemove").unsubscribe("mouseup");document.onselectstart=null;delete this._dragOffset},_buildRankTops:function(){var e=this.$el.find(this.ENABLED_SORTABLE_SELECTOR),t={};e.each(function(e,i){var n=$(i),s,o=n.position().top;if(e!==0){for(s=o-2;s<=o+2;s++){t[Math.ceil(s)]=e}}});this._rankTops=t},_movePlaceholder:function(e){var t=this._$rankContainer,i=t.children(),n=this._placeholderIndex,s=i.eq(n),o=i.eq(e);if(n<e){o.after(s)}else if(n>e){o.before(s)}this._buildRankTops();this._placeholderIndex=e},_rankPosition:function(e){var t=e.index(),i=t+1,n=this._rankToValue[i],s=e.find("select");s.val(n).trigger("change")},_rankPositions:function(){var e=this,t=this.$el.find(this.SORTABLE_SELECTOR);t.each(function(t,i){var n=$(i),s=n.find("select"),o=s.val(),r=e._rankToValue[t+1];if(o!==e._rankToValue.na){s.val(r);e._syncHiddenValue(s)}})}});SM.SurveyPageForm=SM.Widgets.register({__NAME:"surveyPageForm",__resizeTimeout:null,__scrollTimeout:null,__ignoreResize:false,__movingToContainer:false,__init:function(){this._hasAutoScroll=$.find("html.auto-scroll").length==1;this._failedValidation=typeof $("[data-question-validation-message]")[0]!="undefined";var e=$.find("button.new-button");this.$el.on("submit",{self:this},this._onSubmit).on("click",".survey-submit-actions button",{self:this},this._onSubmitClick).on("keydown","input, select",{self:this},this._onKeydownAny).on("keydown","input[type=radio]",{self:this},this._onKeydownRadio).on("keyup","input[type=radio]",{self:this},this._onKeyupRadio);$(window).on("unload",{self:this},this._onWindowUnload).on("pagehide",{self:this},this._onWindowUnload).on("load",{self:this},this._onLoad).on("orientationchange resize",{self:this},this._onResize);if($(".question-fileupload").length>0){$(window).on("beforeunload",{self:this},this._onWindowBeforeUnloadFileUpload)}if(this._hasAutoScroll){this.$el.on("click","div.question-click-shield",{self:this},this._onClickShieldClick).on("focus","div.question-row input, div.question-row select, div.question-row textarea",{self:this},this._onFocusInput);$(window).on("scroll",{self:this},this._onScroll).on("touchstart",{self:this},this._onTouchStart).on("touchend",{self:this},this._onTouchEnd);$("article.survey-page").data("ignoreScroll",false);if(e.length>0){$(e).on("click",{self:this},this._onOkButtonClick)}}},_onLoad:function(e){var t=e.data.self;t._applyOverflowClasses.apply(t);t._removeNoTouchClasses.apply(t);t._resetReportProblemIconPosition();if(t._hasAutoScroll){var i=$("h3.page-subtitle, div.question-row"),n=$("div.question-click-shield"),s=$("article.survey-page");t._resetHeaderMargin();t._resetButtonActionsMargin();t._resetClickShields();if(i.length){if($("h3.page-subtitle:not(.overlay), div.question-row:not(.overlay)").length===0){i.first().removeClass("overlay");t._resetPresentationButtons(i.first())}$("div.question-row:not(.overlay)").first().prev("div.question-click-shield").hide();if(t._failedValidation){var o=$("[data-question-validation-message]")[0],r=$(o).closest("div.question-row");t._moveToContainer(r)}}t._resetProgressBar();if(SM.Touch&&SM.Touch.isTouchDevice()){$("div.report-problem-container").hide()}s.fadeTo(300,1)}},_onResize:function(e){var t=e.data.self,i=$("h3.page-subtitle, div.question-row").not(".overlay").first();var n=function(){t._applyOverflowClasses.apply(t);t._resetReportProblemIconPosition();if(t._hasAutoScroll){t._resetHeaderMargin();$(window).scrollTop(t._calculateMoveLocation(i))}};if(!t.__ignoreResize){clearTimeout(t.__resizeTimeout);t.__resizeTimeout=setTimeout(n,300)}},_onWindowUnload:function(e){var t=e.data.self;t.set("isSubmitting",false)},_onWindowBeforeUnloadFileUpload:function(e){var t=e.data.self,i=$(".upload-status.sm-spin");if(i.length>0){$(".survey-submit-actions button").removeClass("submitting");t.set("isSubmitting",false)}},_onScroll:function(e){var t=e.data.self,i=$("article.survey-page").data("ignoreScroll");if(i!==true){var n=$("h3.page-subtitle, div.question-row"),s=$("div.question-click-shield"),o=0,r=$(window).height()/2;n.each(function(e,t){if($(t).position().top-$(window).scrollTop()<=r){o=e}});if($(n.get(o)).hasClass("overlay")){t._resetOverlays();t._resetClickShields();t._resetPresentationButtons(n.get(o));$(n.get(o)).removeClass("overlay");if($("h3.page-subtitle").length==1&&o>0){$(s.get(o-1)).hide()}else if(!($("h3.page-subtitle").length==1&&o===0)){$(s.get(o)).hide()}$(n.get(o)).trigger("select")}}},_onKeydownAny:function(e){var t=e.data.self,i=$(this).attr("type"),n=e.which===SM.KeyCodes.ENTER||e.which===SM.KeyCodes.NUMPAD_ENTER;if(n){e.preventDefault();if(i==="radio"||i==="checkbox"){t._toggle(this)}}},_onKeydownRadio:function(e){var t=e.data.self,i=e.which===SM.KeyCodes.SPACE;if(i){e.preventDefault();t._toggle(this)}},_onKeyupRadio:function(e){var t=e.data.self,i=e.which===SM.KeyCodes.SPACE;if(i){e.preventDefault()}},_onSubmit:function(e){var t=e.data.self;if(t.get("isSubmitting")){e.stopPropagation();e.preventDefault()}else{t.set("isSubmitting",true)}},_onSubmitClick:function(e){var t=e.data.self;if(!t.get("isSubmitting")){if($(["data-preset-question"])&&$(":disabled")){$(":disabled").removeAttr("disabled")}$(this).addClass("submitting")}},_onClickShieldClick:function(e){var t=e.data.self,i=$(e.target),n=i.next("div.question-row");if(n.hasClass("overlay")){t._moveToContainer(n)}},_onFocusInput:function(e){var t=e.data.self,i=$(e.target).closest("div.question-row");if(i.hasClass("overlay")){t._moveToContainer(i)}},_onOkButtonClick:function(e){var t=e.data.self,i=$(this);e.preventDefault();e.stopPropagation();i.addClass("hide");SM.SurveyPageForm.switchToNextQuestion(i)},_onTouchStart:function(e){var t=e.data.self;t.__ignoreResize=true},_onTouchEnd:function(e){var t=e.data.self;setTimeout(function(){t.__ignoreResize=false},500)},_applyOverflowClasses:function(){var e=this;e.$el.find(".question-body").each(function(){if(this.scrollWidth>this.offsetWidth+50){$(this).addClass("question-overflow")}})},_removeNoTouchClasses:function(){var e=this;if(SM.Touch.isTouchDevice()){$(e.$el.find(".no-touch")).removeClass("no-touch")}},_toggle:function(e){var t=$(e);t.prop("checked",!t.prop("checked")).trigger("change")},_moveToContainer:function(e){var t=this,i=$("h3.page-subtitle, div.question-row"),n=$("h3.page-subtitle, div.question-row").not(".overlay").first(),s=350;if(n.length==1&&!t.__movingToContainer){var o=n.prev("div.question-click-shield"),r=$(e).prev("div.question-click-shield");n.addClass("overlay");if(o.length){o.show()}$(e).removeClass("overlay");if(r.length){r.hide()}t._resetProgressBar();$("article.survey-page").data("ignoreScroll",true);var a="html";if(navigator.userAgent.match(/Chrome|Safari/i))a="body";t._resetPresentationButtons(e);moveToLocation=t._calculateMoveLocation(e);t.__movingToContainer=true;$(a).animate({scrollTop:moveToLocation},s,"swing",$.proxy(this._scrollAnimationCallback,t,e))}},_resetPresentationButtons:function(e){$("h3.page-subtitle button.new-button, div.question-row button.new-button").addClass("hide");if($(e).find("div[data-question-type^=presentation]").length==1||$(e).hasClass("page-subtitle")){button=$(e).find("button.new-button");if($(button).length==1){$(button).removeClass("hide")}}},_resetHeaderMargin:function(){var e=$(window).height(),t=$("header.survey-page-header").height(),i=$(".sm-progressbar").height(),n=e-i,s=$($("h3.page-subtitle, div.question-row")[0]).height();margin=s>0?Math.max(10,n/2-s/2-t):0;$surveyContainer=$("section.survey-page-body");$surveyContainer.css("margin-top",margin+"px")},_resetButtonActionsMargin:function(){var e=$("div.survey-submit-actions"),t=$("footer.survey-footer"),i=$(window).height()/2-e.height()+10;if(t.length==1){t.css("margin-bottom",i+"px")}else{e.css("margin-bottom",i+"px")}if($(window).height()<=640){e.css("margin-top",i+"px")}},_resetClickShields:function(){var e=$("div.question-click-shield");e.each(function(e,t){$(t).show();var i=$(t).next("div.question-row");if(i.length===1){$(t).height(i.height()).width(i.width())}})},_calculateMoveLocation:function(e){var t=$(window).height(),i=$(".sm-progressbar").height(),n=$(e).offset().top-(t-i)/2+$(e).height()/2;if(n>$(e).offset().top-10)n=$(e).offset().top-10;return Math.max(0,n)},_resetOverlays:function(){$containers=$("h3.page-subtitle, div.question-row");$containers.each(function(e,t){if(!$(t).hasClass("overlay")){$(t).addClass("overlay")}})},_resetProgressBar:function(){var e=$("div.question-row:not(:has(div[data-question-type^=presentation]))"),t=parseInt($("div.sm-progress span[data-response-count]").attr("data-response-count")),i=parseInt($("div.sm-progress span[data-question-count]").attr("data-question-count"));e.each(function(e,i){if($(i).find("input:checked").length>0)t+=1;else if($(i).find("select").length>0&&$(i).find("select").val()!=="")t+=1;else if($(i).find("input[type=tel]").filter(function(){return!!this.value}).length>0)t+=1;else if($(i).find("input[type=text]").filter(function(){return!!this.value}).length>0)t+=1;else if($(i).find("textarea").filter(function(){return!!this.value}).length>0)t+=1;else if($($(i).find("a.file-upload-clear-btn")[0]).is(":visible"))t+=1});$("div.sm-progress span[data-response-count]").html(t);$("div.sm-progressbar div.bar div").animate({width:t*100/i+"%"},350,"swing")},_resetReportProblemIconPosition:function(){var e=$(window).innerWidth()-document.body.clientWidth+10;$(".report-problem-container-spage a.report-problem-trigger").css("right",e+"px")},_scrollAnimationCallback:function(e){var t=this;setTimeout(function(){$("article.survey-page").data("ignoreScroll",false);$(e).trigger("select");t.__movingToContainer=false},200)},switchToNextQuestion:function(e){var t=this,i=$(e).closest("h3.page-subtitle, div.question-row"),n=i.nextAll("div.question-row:first"),s=t.isOnScreen($("div.survey-submit-actions"));if(i.is("h3")){n=$("html").find("div.question-row:first")}if(n.length>0){if(n.hasClass("overlay")){setTimeout(function(){t._moveToContainer(n)},200)}}else{var o=300,r="html";if(navigator.userAgent.match(/Chrome|Safari/i))r="body";t._resetProgressBar();moveToLocation=t._calculateMoveLocation($("div.survey-submit-actions"));$(r).animate({scrollTop:moveToLocation},o,"swing")}},isOnScreen:function(e){var t=$(window);var i={top:t.scrollTop(),left:t.scrollLeft()};i.right=i.left+t.width();i.bottom=i.top+t.height();var n=e.offset();n.right=n.left+e.outerWidth();n.bottom=n.top+e.outerHeight();return!(i.right<n.left||i.left>n.right||i.bottom<n.top||i.top>n.bottom)}});SM.Slider=SM.Widgets.register({__NAME:"slider",__init:function(){this._cacheElements()._setLayoutData()._setValues()._bindEvents()},__defaults:{constraints:{min:0,max:100,step:1},value:0,rangeMin:0,rangeMax:100,options:{restrictStepSize:true,animateClick:false}},__setters:{constraints:function(e,t){e._setConstraints(t)},rangeMin:function(e,t){if(!e._isRange){return}e._setRangeMinView(t)._setRangeMin(t)},rangeMax:function(e,t){if(!e._isRange){return}e._setRangeMaxView(t)._setRangeMax(t)},value:function(e,t){if(e._isRange){return}e._setValueView(t)._setValue(t)},restrictStepSize:function(e,t){if(typeof t!=="boolean"){return}e._setStepSizeRestriction(t)}},_setConstraints:function(e){SM.Object.update(this.__settings.constraints,e);this._setLayoutData()._setValues().__trigger("constraintChange");return this},_setValue:function(e){var t=this.__settings,i=t.constraints;e=this._constrainValue(i.min,i.max,e);if(t.value===e){return this}t.value=e;this.__trigger("change");return this},_setRangeMax:function(e){var t=this.__settings,i=t.constraints;e=this._constrainValue(t.rangeMin+i.step,i.max,e);if(t.rangeMax===e){return this}t.rangeMax=e;this.__trigger("change");return this},_setRangeMin:function(e){var t=this.__settings,i=t.constraints;e=this._constrainValue(i.min,t.rangeMax-i.step,e);if(t.rangeMin===e){return this}t.rangeMin=e;this.__trigger("change");return this},_setStepSizeRestriction:function(e){var t=this.__settings,i=t.options.restrictStepSize;if(!i&&e&&!this._stepSizeDividePerfectly()){throw new Error("Cannot restrict the step size of a slider that previously allowed and "+"had a step size that didn't divide max - min")}t.options.restrictStepSize=e;return this},_stepSizeDividePerfectly:function(){var e=this.__settings.constraints,t=e.max-e.min;return t%e.step===0},_setValueView:function(e,t){var i,n=this.__settings,s=n.constraints;e=this._constrainValue(s.min,s.max,e);i=this._valueToHandlePosition(e);if(this._handleLabel){this._$label.text(e)}if(!t){this.__trigger({type:"slide",value:e,$label:this._$label})}else{this.__trigger({type:"start",value:e,$label:this._$label})}if(!n.options.animateClick||!t){this._$handle.css("left",i)}else{this._$handle.stop().animate({left:i},300)}if(this._handleLabel){this._positionLabel(this._$label,this._$handle)}return this},_setRangeMaxView:function(e){var t,i=this.__settings,n=i.constraints;e=this._constrainValue(i.rangeMin+n.step,n.max,e);t=this._valueToHandlePosition(e);this._$maxHandle.css("left",t);if(this._handleLabel){this._$maxLabel.text(e)}this.__trigger({type:"slide",value:e,$label:this._$maxLabel});if(this._handleLabel){this._positionLabel(this._$maxLabel,this._$maxHandle)}this._adjustMaxEnd(t);return this},_setRangeMinView:function(e){var t,i=this.__settings,n=i.constraints;e=this._constrainValue(n.min,i.rangeMax-n.step,e);t=this._valueToHandlePosition(e);this._$minHandle.css("left",t);if(this._handleLabel){this._$minLabel.text(e)}this.__trigger({type:"slide",value:e,$label:this._$minLabel});if(this._handleLabel){this._positionLabel(this._$minLabel,this._$minHandle)}this._adjustMinEnd(t);return this},_cacheElements:function(){this._$handle=this.$el.find("a");if(this._$handle.length>1){this._$minHandle=this._$handle.eq(0);this._$maxHandle=this._$handle.eq(1);this._$range=this.$el.find("div");this._isRange=true}this._$label=this.$el.find("span.slider-label");this._handleLabel=this._$label.length>0;if(this._$label.length>1){this._$minLabel=this._$label.eq(0);this._$maxLabel=this._$label.eq(1)}return this},_setLayoutData:function(){var e=this.__settings.constraints,t;t=e.max-e.min;if(this.__settings.options.restrictStepSize&&!this._stepSizeDividePerfectly()){throw new Error("your min - max must be divisible by your step")}this._width=this.$el.outerWidth();this._stepPixelDistance=this._width/t*e.step;return this},_setValues:function(){var e=this.__settings;if(!this._isRange){this._setValueView(e.value)._setValue(e.value).__trigger("change")}else{this._setRangeMinView(e.rangeMin)._setRangeMin(e.rangeMin)._setRangeMaxView(e.rangeMax)._setRangeMax(e.rangeMax).__trigger("change")}return this},_bindEvents:function(){if(this._isRange){this.$el.on("click",{slider:this},this._onRangeClick);this._$minHandle.on("mousedown",{slider:this,setter:"_setRangeMin"},this._onHandleMouseDown).on("touchstart",{slider:this,setter:"_setRangeMin"},this._onHandleMouseDown).on("keydown",{slider:this,viewSetter:"_setRangeMinView"},this._onHandleKeyDown).on("keyup",{slider:this,setter:"_setRangeMin"},this._onHandleKeyUp).on("click",this._onHandleClick);this._$maxHandle.on("mousedown",{slider:this,setter:"_setRangeMax"},this._onHandleMouseDown).on("touchstart",{slider:this,setter:"_setRangeMax"},this._onHandleMouseDown).on("keydown",{slider:this,viewSetter:"_setRangeMaxView"},this._onHandleKeyDown).on("keyup",{slider:this,setter:"_setRangeMax"},this._onHandleKeyUp).on("click",{slider:this},this._onHandleClick)}else{this.$el.on("click",{slider:this},this._onClick);this._$handle.on("mousedown",{slider:this,setter:"_setValue"},this._onHandleMouseDown).on("touchstart",{slider:this,setter:"_setValue"},this._onHandleMouseDown).on("keydown",{slider:this,viewSetter:"_setValueView"},this._onHandleKeyDown).on("keyup",{slider:this,setter:"_setValue"},this._onHandleKeyUp).on("click",{slider:this},this._onHandleClick)}if(this._handleLabel){$(window).on("resize."+this.__NAME+this.__uid,{slider:this},this._onGlobalResize)}return this},_valueToHandlePosition:function(e){var t=this.__settings.constraints,i=e-t.min,n=Math.round(i/t.step),s=e===t.max?this._width:n*this._stepPixelDistance;return s},_handlePositionToValue:function(e){var t=this.__settings.constraints,i=Math.ceil(this._width/this._stepPixelDistance),n=Math.round(e/this._stepPixelDistance),s=n*t.step,o=s+t.min,r=this._width-this._stepPixelDistance*(i-1),a=e-this._stepPixelDistance*(i-1);if(Math.ceil(e/this._stepPixelDistance)===i&&a>r/2){return t.max}return o},_adjustMinEnd:function(e){this._$range.css("left",e)},_adjustMaxEnd:function(e){this._$range.css("right",this._width-e)},_constrainValue:function(e,t,i){if(i>t){i=t}else if(i<e){i=e}return i},_positionLabel:function(e,t){var i=parseInt(t.css("left"),10),n=t.outerWidth(),s,o=e.outerWidth();if(!e.is(":visible")){o=e.appendTo(document.body).outerWidth();e.appendTo(this.$el)}s=i-(o-n)/2;e.css("left",s);return this},_onClick:function(e){var t=e.data.slider,i=e.pageX-t.$el.offset().left,n=t._handlePositionToValue(i);t._setValueView(n,true);t._setValue(n);t.__trigger("change")},_onRangeClick:function(e){var t=e.data.slider,i=e.pageX-t.$el.offset().left,n=t._handlePositionToValue(i),s=Math.abs(n-t.__settings.rangeMax),o=Math.abs(n-t.__settings.rangeMin);if(s<=o){t._setRangeMaxView(n);t._setRangeMax(n)}else{t._setRangeMinView(n);t._setRangeMin(n)}},_onHandleKeyDown:function(e){var t=$(this),i=e.data.slider,n=i.__settings.constraints,s=e.data.viewSetter,o=e.which,r=i._handlePositionToValue(parseInt(t.css("left"),10));if(!o){return}if(o===SM.KeyCodes.LEFT){i.__trigger("start");i[s](r-n.step)}else if(o===SM.KeyCodes.RIGHT){i.__trigger("start");i[s](r+n.step)}},_onHandleKeyUp:function(e){var t=$(this),i=e.data.slider,n=e.data.setter,s=e.which,o=i._handlePositionToValue(parseInt(t.css("left"),10));if(!s){return}if(s===SM.KeyCodes.LEFT){i[n](o)}else if(s===SM.KeyCodes.RIGHT){i[n](o)}},_onHandleClick:function(e){e.preventDefault()},_onHandleMouseDown:function(e){var t=$(this),i=e.data.setter+"View",n=e.data.slider;this.ondragstart=function(){return false};document.onselectstart=function(){return false};t.focus();n.__trigger("start").__subscribe("touchend",n._onGlobalMouseup,{valueSetter:e.data.setter}).__subscribe("touchmove",n._onGlobalMousemove,{viewSetter:i}).__subscribe("mouseup",n._onGlobalMouseup,{valueSetter:e.data.setter}).__subscribe("mousemove",n._onGlobalMousemove,{viewSetter:i});e.preventDefault()},_onGlobalMouseup:function(e){var t=e.data.slider,i=e.type==="touchend"?parseInt($(e.target).css("left").replace("px",""),10):e.pageX,n=e.type==="touchend"?i:i-t.$el.offset().left,s=e.data.valueSetter,o=t._handlePositionToValue(n);t.__unsubscribe("touchmove").__unsubscribe("touchend").__unsubscribe("mousemove").__unsubscribe("mouseup");document.onselectstart=null;t[s](o,true);t.__trigger("stop")},_onGlobalMousemove:function(e){var t=e.data.slider,i=e.data.viewSetter,n=e.type==="touchmove"?e.originalEvent.touches[0].pageX:e.pageX,s=n-t.$el.offset().left,o=t._handlePositionToValue(s);t[i](o)},_onGlobalResize:function(e){var t=e.data.slider;if(t._isRange){t._positionLabel(t._$minLabel,t._$minHandle);t._positionLabel(t._$maxLabel,t._$maxHandle)}else{t._positionLabel(t._$label,t._$handle)}}});SM.EmojiRatingQuestion=SM.Widgets.register({__NAME:"emojiRatingQuestion",__init:function(){var e=this;this._radioMouseClicked=false;this.$el.on("change","input[type=radio]",{self:this},this._onChange).on("click",".emoji-rating",{self:this},this._onClick).on("mouseenter",".emoji-color, .emoji-button-input, .emoji-border",{self:this},this._onMouseEnter).on("mouseleave",".emoji-color, .emoji-button-input, .emoji-border",{self:this},this._onMouseLeave).on("mouseup","input[type=radio]",{self:this},this._onMouseUp).on("focusin","input[type=radio]",{self:this},this._onFocusin).on("focusout","input[type=radio]",{self:this},this._onFocusout);this._refreshEmojiState()},_onMouseEnter:function(e){var t=e.data.self,i=t.$el.closest(".question-emoji-rating-table"),n=t.$el.find(".emoji-rating"),s=i.find(".emoji-rating");s.each(function(e,t){$(t).addClass("selected");$(t).find(".emoji-border").addClass("hovered");if(n.is($(t)))return false})},_onMouseLeave:function(e){var t=e.data.self,i=t.$el.closest(".question-emoji-rating-table"),n=t.$el.find(".emoji-rating"),s=i.find("[data-sm-emoji-button]");s.each(function(e,t){var i=$(t).find("input:checked");if(i.length!=1){$(t).find(".emoji-rating").removeClass("selected");$(t).find(".emoji-border").removeClass("hovered")}if(n.is($(t)))return false});t._refreshEmojiState()},_onMouseUp:function(e){var t=e.data.self,i=t.$el.closest("[data-sm-emoji-button]"),n=i.find(".emoji-border");n.removeClass("focus");t._radioMouseClicked=true},_onFocusin:function(e){var t=e.data.self,i=t.$el.closest("[data-sm-emoji-button]"),n=i.find(".emoji-border");n.addClass("focus")},_onFocusout:function(e){var t=e.data.self,i=t.$el.closest("[data-sm-emoji-button]"),n=i.find(".emoji-border");n.removeClass("focus")},_onChange:function(e){var t=e.data.self,i=t.$el.find("input[type=radio]");t._radioMouseClicked=false;t._refreshEmojiState()},_onClick:function(e){var t=e.data.self,i=t.$el.find("input[type=radio]");if(!$(e.target).is(i)){i.prop("checked",!i.prop("checked"));i.trigger("change")}else if(t._radioMouseClicked&&i.data("selected")){i.prop("checked",false);i.trigger("change")}},_refreshEmojiState:function(){var e=this,t=e.$el.closest(".question-emoji-rating-table"),i=t.find("[data-sm-emoji-button]"),n=i.find("input:checked");i.find(".emoji-rating").removeClass("selected");i.find(".emoji-border").removeClass("hovered");i.find("input[type=radio]").data("selected",false);if(n.length==1){i.each(function(e,t){$(t).find(".emoji-rating").addClass("selected");var i=$(t).find("input:checked");if(i.length==1){if(!i.data("selected"))i.data("selected",true);return false}})}}});SM.OpenEnded=SM.Widgets.register({__NAME:"openEnded",__init:function(){this._hasAutoScroll=$.find("html.auto-scroll").length==1;if(this._hasAutoScroll){this.$el.on("keyup",{self:this},this._onTextChange)}},_onTextChange:function(e){var t=e.data.self,i=$(e.target),n=i.closest("div.question-row").find("button.new-button");if(i.val().length>0){$(n).removeClass("hide")}}});SM.FacebokShareButton=SM.Widgets.register({__NAME:"fbShareBtn",__init:function(){this.$el.on("click",{self:this},this._onClick)},_onClick:function(e){e.preventDefault();var t=e.data.self;t._fbShareBtn(t.$el.attr("data-facebook-app-id"),"",t.$el.attr("data-survey-title"),t.$el.attr("data-redirect-url"))},_getQueryVariable:function(e){var t=window.location.search.substring(1);var i=t.split("&");for(var n=0;n<i.length;n++){var s=i[n].split("=");if(decodeURIComponent(s[0])===e){return decodeURIComponent(s[1])}}},_fbShareBtn:function(e,t,i,n){var s="http://www.facebook.com/dialog/feed?app_id="+e+"&show_error=true&",o=this._getQueryVariable("na")==="new_auth"?"user/auth/":"closepop.aspx";if(t===""){s+="link="+encodeURI(location.href)+"&"}else{s+="link="+encodeURI("http://facebook.com/pages/SM-Survey-View/"+t+"?sk=app_"+e)+"&";s+="caption= &"}s+="name="+i+"&";s+="description="+window.escape('Please take the survey titled "'+i+'". Your feedback is important!')+"&";s+="picture="+$('link[rel="image_src"]').attr("href")+"&";s+="redirect_uri=http://"+n+"/"+o+"?close=true";var r=window.open(s,"_blank","width=700,height=580,scrollbars=yes");r.focus()}});$(function(){var e="survey_file_uploader",t=$("[data-question-fileupload]"),i=$.find("article.auto-scroll").length==1;function n(){var e=$("body"),t=$("#hcmtest"),i;if(t.length==1){i=t.css("background-color").toLowerCase();t.remove();if(i!=="#878787"&&i!=="rgb(135, 135, 135)"){e.addClass("is-high-contrast");$(".btn").removeClass("btn")}}}$("[data-survey-page-form]").surveyPageForm();$("[data-previous-page-button]").on("click",function(e){$("#is_previous").val(true)});$("[data-other-text]").otherAnswerTextOption();$("[data-forced-ranking]").forcedRankingQuestion();$("[data-nps]").npsQuestion();$("[data-question-ranking]").rankingQuestion();$('[data-exit-survey-btn][href="#"]').on("click",function(e){window.close()});$("[data-radio-button-group]").radioButtonGroup();$("[data-sm-checkbox]").checkbox();$("[data-sm-select]").dropdown();$("[data-sm-emoji-button]").emojiRatingQuestion();$("[data-question-slider]").sliderQuestion();$("[data-sm-textarea]").openEnded();$("[data-sm-open-single]").openEnded();$("[data-other-text]").openEnded();$("[data-datetime-text]").openEnded();if(t.length){t.fileUploadQuestion({uploaderConfig:__UPLOADER,uploadAreaTemplateId:e})}if(typeof $("[data-question-validation-message]")[0]!="undefined"&&!i){$("[data-question-validation-message]").first().focus();$("[data-question-validation-message]")[0].scrollIntoView()}$("#fb_share_btn").fbShareBtn();n();if(SM.Touch.isTouchDevice()){SM.Touch.init(document.body)}});$(function(){if(typeof performance.mark!="undefined"){var e=[];var t=performance.getEntriesByType("mark");for(i=0;i<t.length;i++){var n=t[i];e.push(n.startTime)}$.ajax({url:"/r/log/load_time",type:"POST",dataType:"json",data:JSON.stringify({load_times:e}),contentType:"application/json"})}});(function(e,t){e.ui=e.ui||{};var i,n=Math.max,s=Math.abs,o=Math.round,r=/left|center|right/,a=/top|center|bottom/,l=/[\+\-]\d+%?/,u=/^\w+/,d=/%$/,f=e.fn.position;function h(e,t,i){return[parseInt(e[0],10)*(d.test(e[0])?t/100:1),parseInt(e[1],10)*(d.test(e[1])?i/100:1)]}function c(t,i){return parseInt(e.css(t,i),10)||0}function _(t){var i=t[0];if(i.nodeType===9){return{width:t.width(),height:t.height(),offset:{top:0,left:0}}}if(e.isWindow(i)){return{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}}if(i.preventDefault){return{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}}return{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.position={scrollbarWidth:function(){if(i!==t){return i}var n,s,o=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),r=o.children()[0];e("body").append(o);n=r.offsetWidth;o.css("overflow","scroll");s=r.offsetWidth;if(n===s){s=o[0].clientWidth}o.remove();return i=n-s},getScrollInfo:function(t){
var i=t.isWindow?"":t.element.css("overflow-x"),n=t.isWindow?"":t.element.css("overflow-y"),s=i==="scroll"||i==="auto"&&t.width<t.element[0].scrollWidth,o=n==="scroll"||n==="auto"&&t.height<t.element[0].scrollHeight;return{width:s?e.position.scrollbarWidth():0,height:o?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]);return{element:i,isWindow:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}};e.fn.position=function(t){if(!t||!t.of){return f.apply(this,arguments)}t=e.extend({},t);var i,d,p,g,v,m,b=e(t.of),$=e.position.getWithinInfo(t.within),S=e.position.getScrollInfo($),w=(t.collision||"flip").split(" "),y={};m=_(b);if(b[0].preventDefault){t.at="left top"}d=m.width;p=m.height;g=m.offset;v=e.extend({},g);e.each(["my","at"],function(){var e=(t[this]||"").split(" "),i,n;if(e.length===1){e=r.test(e[0])?e.concat(["center"]):a.test(e[0])?["center"].concat(e):["center","center"]}e[0]=r.test(e[0])?e[0]:"center";e[1]=a.test(e[1])?e[1]:"center";i=l.exec(e[0]);n=l.exec(e[1]);y[this]=[i?i[0]:0,n?n[0]:0];t[this]=[u.exec(e[0])[0],u.exec(e[1])[0]]});if(w.length===1){w[1]=w[0]}if(t.at[0]==="right"){v.left+=d}else if(t.at[0]==="center"){v.left+=d/2}if(t.at[1]==="bottom"){v.top+=p}else if(t.at[1]==="center"){v.top+=p/2}i=h(y.at,d,p);v.left+=i[0];v.top+=i[1];return this.each(function(){var r,a,l=e(this),u=l.outerWidth(),f=l.outerHeight(),_=c(this,"marginLeft"),m=c(this,"marginTop"),C=u+_+c(this,"marginRight")+S.width,M=f+m+c(this,"marginBottom")+S.height,E=e.extend({},v),T=h(y.my,l.outerWidth(),l.outerHeight());if(t.my[0]==="right"){E.left-=u}else if(t.my[0]==="center"){E.left-=u/2}if(t.my[1]==="bottom"){E.top-=f}else if(t.my[1]==="center"){E.top-=f/2}E.left+=T[0];E.top+=T[1];if(!e.support.offsetFractions){E.left=o(E.left);E.top=o(E.top)}r={marginLeft:_,marginTop:m};e.each(["left","top"],function(n,s){if(e.ui.position[w[n]]){e.ui.position[w[n]][s](E,l,{targetWidth:d,targetHeight:p,elemWidth:u,elemHeight:f,collisionPosition:r,collisionWidth:C,collisionHeight:M,offset:[i[0]+T[0],i[1]+T[1]],my:t.my,at:t.at,within:$,elem:l})}});if(t.using){a=function(e){var i=g.left-E.left,o=i+d-u,r=g.top-E.top,a=r+p-f,h={target:{element:b,left:g.left,top:g.top,width:d,height:p},element:{element:l,left:E.left,top:E.top,width:u,height:f},horizontal:o<0?"left":i>0?"right":"center",vertical:a<0?"top":r>0?"bottom":"middle"};if(d<u&&s(i+o)<d){h.horizontal="center"}if(p<f&&s(r+a)<p){h.vertical="middle"}if(n(s(i),s(o))>n(s(r),s(a))){h.important="horizontal"}else{h.important="vertical"}t.using.call(this,e,h)}}l.offset(e.extend(E,{using:a}))})};e.ui.position={fit:{left:function(e,t,i){var s=i.within,o=s.isWindow?s.scrollLeft:s.offset.left,r=s.width,a=e.left-i.collisionPosition.marginLeft,l=o-a,u=a+i.collisionWidth-r-o,d;if(i.collisionWidth>r){if(l>0&&u<=0){d=e.left+l+i.collisionWidth-r-o;e.left+=l-d}else if(u>0&&l<=0){e.left=o}else{if(l>u){e.left=o+r-i.collisionWidth}else{e.left=o}}}else if(l>0){e.left+=l}else if(u>0){e.left-=u}else{e.left=n(e.left-a,e.left)}},top:function(e,t,i){var s=i.within,o=s.isWindow?s.scrollTop:s.offset.top,r=i.within.height,a=e.top-i.collisionPosition.marginTop,l=o-a,u=a+i.collisionHeight-r-o,d;if(i.collisionHeight>r){if(l>0&&u<=0){d=e.top+l+i.collisionHeight-r-o;e.top+=l-d}else if(u>0&&l<=0){e.top=o}else{if(l>u){e.top=o+r-i.collisionHeight}else{e.top=o}}}else if(l>0){e.top+=l}else if(u>0){e.top-=u}else{e.top=n(e.top-a,e.top)}}},flip:{left:function(e,t,i){var n=i.within,o=n.offset.left+n.scrollLeft,r=n.width,a=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-i.collisionPosition.marginLeft,u=l-a,d=l+i.collisionWidth-r-a,f=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,h=i.at[0]==="left"?i.targetWidth:i.at[0]==="right"?-i.targetWidth:0,c=-2*i.offset[0],_,p;if(u<0){_=e.left+f+h+c+i.collisionWidth-r-o;if(_<0||_<s(u)){e.left+=f+h+c;t.trigger("position.horizontal.flip")}}else if(d>0){p=e.left-i.collisionPosition.marginLeft+f+h+c-a;if(p>0||s(p)<d){e.left+=f+h+c;t.trigger("position.horizontal.flip")}}},top:function(e,t,i){var n=i.within,o=n.offset.top+n.scrollTop,r=n.height,a=n.isWindow?n.scrollTop:n.offset.top,l=e.top-i.collisionPosition.marginTop,u=l-a,d=l+i.collisionHeight-r-a,f=i.my[1]==="top",h=f?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,c=i.at[1]==="top"?i.targetHeight:i.at[1]==="bottom"?-i.targetHeight:0,_=-2*i.offset[1],p,g;if(u<0){g=e.top+h+c+_+i.collisionHeight-r-o;if(e.top+h+c+_>u&&(g<0||g<s(u))){e.top+=h+c+_;t.trigger("position.vertical.flip")}}else if(d>0){p=e.top-i.collisionPosition.marginTop+h+c+_-a;if(e.top+h+c+_>d&&(p>0||s(p)<d)){e.top+=h+c+_;t.trigger("position.vertical.flip")}}}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments);e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments);e.ui.position.fit.top.apply(this,arguments)}}};(function(){var t,i,n,s,o,r=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(r?"div":"body");n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(r){e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"})}for(o in n){t.style[o]=n[o]}t.appendChild(a);i=r||document.documentElement;i.insertBefore(t,i.firstChild);a.style.cssText="position: absolute; left: 10.7432222px;";s=e(a).offset().left;e.support.offsetFractions=s>10&&s<11;t.innerHTML="";i.removeChild(t)})()})(jQuery);jQuery.migrationFixPosition=function(e){var t,i,n,s;function o(e){if(e[0]!=="-"&&e[0]!=="+"){e="+"+e}return e}if(!e){return e}if($().jquery.indexOf("1.7")>=0||$().jquery.indexOf("1.8")>=0){return e}t=e.at;i=e.offset;if(!i){return e}if(!t){return e}n=t.split(" ");s=i.split(" ");if(s.length){s[0]=o(s[0])}if(s.length>1){s[1]=o(s[1])}e.at=n[0]+s[0]+" "+n[1]+s[1];return e};var Mustache=typeof module!=="undefined"&&module.exports||{};(function(e){e.name="mustache.js";e.version="0.5.0-dev";e.tags=["<%","%>"];e.parse=v;e.compile=S;e.render=w;e.clearCache=$;e.to_html=function(e,t,i,n){var s=w(e,t,i);if(typeof n==="function"){n(s)}else{return s}};var t=Object.prototype.toString;var i=Array.isArray;var n=Array.prototype.forEach;var s=String.prototype.trim;var o;if(i){o=i}else{o=function(e){return t.call(e)==="[object Array]"}}var r;if(n){r=function(e,t,i){return n.call(e,t,i)}}else{r=function(e,t,i){for(var n=0,s=e.length;n<s;++n){t.call(i,e[n],n,e)}}}var a=/^\s*$/;function l(e){return a.test(e)}var u;if(s){u=function(e){return e==null?"":s.call(e)}}else{var d,f;if(l("\xa0")){d=/^\s+/;f=/\s+$/}else{d=/^[\s\xA0]+/;f=/[\s\xA0]+$/}u=function(e){return e==null?"":String(e).replace(d,"").replace(f,"")}}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function c(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return h[e]||e})}function _(e,t,i,n){n=n||"<template>";var s=t.split("\n"),o=Math.max(i-3,0),r=Math.min(s.length,i+3),a=s.slice(o,r);var l;for(var u=0,d=a.length;u<d;++u){l=u+o+1;a[u]=(l===i?" >> ":"    ")+a[u]}e.template=t;e.line=i;e.file=n;e.message=[n+":"+i,a.join("\n"),"",e.message].join("\n");return e}function p(e,t,i){if(e==="."){return t[t.length-1]}var n=e.split(".");var s=n.length-1;var o=n[s];var r,a,l=t.length,u,d;while(l){d=t.slice(0);a=t[--l];u=0;while(u<s){a=a[n[u++]];if(a==null){break}d.push(a)}if(a&&typeof a==="object"&&o in a){r=a[o];break}}if(typeof r==="function"){r=r.call(d[d.length-1])}if(r==null){return i}return r}function g(e,t,i,n){var s="";var a=p(e,t);if(n){if(a==null||a===false||o(a)&&a.length===0){s+=i()}}else if(o(a)){r(a,function(e){t.push(e);s+=i();t.pop()})}else if(typeof a==="object"){t.push(a);s+=i();t.pop()}else if(typeof a==="function"){var l=t[t.length-1];var u=function(e){return w(e,l)};s+=a.call(l,i(),u)||""}else if(a){s+=i()}return s}function v(t,i){i=i||{};var n=i.tags||e.tags,s=n[0],o=n[n.length-1];var r=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var a=[],d=false,f=false;var h=function(){if(d&&!f&&!i.space){while(a.length){r.splice(a.pop(),1)}}else{a=[]}d=false;f=false};var c=[],p,g,v;var m=function(e){n=u(e).split(/\s+/);g=n[0];v=n[n.length-1]};var b=function(e){r.push('";',p,'\nvar partial = partials["'+u(e)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')};var $=function(e,n){var s=u(e);if(s===""){throw _(new Error("Section name may not be empty"),t,M,i.file)}c.push({name:s,inverted:n});r.push('";',p,'\nvar name = "'+s+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')};var S=function(e){$(e,true)};var w=function(e){var n=u(e);var s=c.length!=0&&c[c.length-1].name;if(!s||n!=s){throw _(new Error('Section named "'+n+'" was never opened'),t,M,i.file)}var o=c.pop();r.push('";',"\n    return buffer;","\n  };","\n})();");if(o.inverted){r.push("\nbuffer += renderSection(name,stack,callback,true);")}else{r.push("\nbuffer += renderSection(name,stack,callback);")}r.push('\nbuffer += "')};var y=function(e){r.push('";',p,'\nbuffer += lookup("'+u(e)+'",stack,"");','\nbuffer += "')};var C=function(e){r.push('";',p,'\nbuffer += escapeHTML(lookup("'+u(e)+'",stack,""));','\nbuffer += "')};var M=1,E,T;for(var k=0,x=t.length;k<x;++k){if(t.slice(k,k+s.length)===s){k+=s.length;E=t.substr(k,1);p="\nline = "+M+";";g=s;v=o;d=true;switch(E){case"!":k++;T=null;break;case"=":k++;o="="+o;T=m;break;case">":k++;T=b;break;case"#":k++;T=$;break;case"^":k++;T=S;break;case"/":k++;T=w;break;case"{":o="}"+o;case"&":k++;f=true;T=y;break;default:f=true;T=C}var R=t.indexOf(o,k);if(R===-1){throw _(new Error('Tag "'+s+'" was not closed properly'),t,M,i.file)}var A=t.substring(k,R);if(T){T(A)}var O=0;while(~(O=A.indexOf("\n",O))){M++;O++}k=R+o.length-1;s=g;o=v}else{E=t.substr(k,1);switch(E){case'"':case"\\":f=true;r.push("\\"+E);break;case"\r":break;case"\n":a.push(r.length);r.push("\\n");h();M++;break;default:if(l(E)){a.push(r.length)}else{f=true}r.push(E)}}}if(c.length!=0){throw _(new Error('Section "'+c[c.length-1].name+'" was not closed properly'),t,M,i.file)}h();r.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var L=r.join("").replace(/buffer \+= "";\n/g,"");if(i.debug){if(typeof console!="undefined"&&console.log){console.log(L)}else if(typeof print==="function"){print(L)}}return L}function m(e,t){var i="view,partials,stack,lookup,escapeHTML,renderSection,render";var n=v(e,t);var s=new Function(i,n);return function(i,n){n=n||{};var o=[i];try{return s(i,n,o,p,c,g,w)}catch(i){throw _(i.error,e,i.line,t.file)}}}var b={};function $(){b={}}function S(e,t){t=t||{};if(t.cache!==false){if(!b[e]){b[e]=m(e,t)}return b[e]}return m(e,t)}function w(e,t,i){return S(e)(t,i)}})(Mustache);var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM")}SM.Html={rtagName:/<([\w:]+)/,rhtml:/<|&#?\w+;/,rxhtmlTag:/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,wrapMap:{option:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},support:{},tagRexExes:{},safeFrag:null,init:function(){this._featureTest();this._extendWrapMap();this.safeFrag=document.createDocumentFragment()},hasTag:function(e,t){return!!this.findFirstTag(e,t)},findFirstTag:function(e,t){var i;t=t.toLowerCase();if(!this.tagRexExes[t]){this.tagRexExes[t]=new RegExp("<"+t+"\\s+(.*?)[^<]\\/?>","i")}i=this.tagRexExes[t].exec(e);return i?i[0]:null},getFirstTagName:function(e){return(this.rtagName.exec(e)||["",""])[1].toLowerCase()},removeExternalAttributes:function(e){return e.replace(/\s+(src|href)=/gi," data-src=")},strip:function(e,t){var i,n,s;if(!e){return""}if(t===undefined){t=true}i=document.createElement("div");e=this.removeExternalAttributes(e);i.innerHTML=e;s=i.textContent||i.innerText;if(t){while(s!==i.innerHTML&&s!==n){n=s;i.innerHTML=s;s=i.textContent||i.innerText}}return s===null||s===undefined?"":s},has:function(e){return this.rhtml.test(e)},parse:function(e){var t,i,n,s,o,r,a,l,u,d,f=[];if(!e||typeof e!=="string"){return[]}if(!this.has(e)){return[document.createTextNode(e)]}i=this.safeFrag;t=i.appendChild(document.createElement("div"));e=e.replace(this.rxhtmlTag,"<$1></$2>");n=this.getFirstTagName(e);s=this.wrapMap[n]||this.wrapMap._default;o=s[0];t.innerHTML=s[1]+e+s[2];while(o--){t=t.lastChild}if(!this.tbodySupport){r=this.hasTag(e,"tbody");if(n==="table"&&!r){a=t.firstChild&&t.firstChild.childNodes}else if(s[1]==="<table>"&&!r){a=t.childNodes}else{a=[]}for(u=a.length-1;u>=0;--u){l=a[u];if(l.nodeName&&l.nodeName.toUpperCase()==="tbody".toUpperCase()&&!l.childNodes.length){l.parentNode.removeChild(l)}}}e=t.childNodes;d=e.length;for(u=0;u<d;u++){f[u]=e[u]}t=i.lastChild;i.removeChild(t);e=t=i=null;return f},_featureTest:function(){var e=document.createElement("div");e.innerHTML="<link/><table></table>";this.support.htmlSerialize=!!e.getElementsByTagName("link").length;this.support.tbody=!e.getElementsByTagName("tbody").length},_extendWrapMap:function(){var e=this.wrapMap;e.optgroup=e.option;e.tbody=e.tfoot=e.colgroup=e.caption=e.thead;e.th=e.td}};SM.Html.init();if(typeof module==="object"&&module.exports){module.exports=SM.Html}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./string");require("./html")}SM.Template={r_mustache_html_whitespace:/(([#\/\^!][^<]*%>)|([^%]>))(\s+)((<[^%])|(<%(?=[#\/\^!])))/g,whitespaceFunc:function(){return arguments[0].replace(arguments[4],"")},render:function(e,t,i){var n,s;if(!this._templates[e]){n=document.getElementById(e);if(!n){throw new Error("Template not found, id: "+e)}s=n.innerHTML;if(n.getAttribute("remove-ws")){s=s.replace(this.r_mustache_html_whitespace,this.whitespaceFunc)}s=SM.String.trim(s);this._templates[e]=s}if(t===undefined){return this._templates[e]}return Mustache.render(this._templates[e],t,i)},renderHTML:function(e,t){var i=this.render(e,t),n=SM.Html.parse(i)[0];n.parentNode.removeChild(n);return n},_templates:{}};if(typeof module==="object"&&module.exports){module.exports=SM.Template}var SM;if(typeof module==="object"&&module.exports&&typeof require==="function"){SM=require("../SM");require("./object");require("./widget");require("./template")}SM.View=SM.Object.extend(SM.Widget,{__templateID:undefined,__beforeRender:function(){return this.__settings},__render:function(e){return SM.Template.renderHTML(this.__templateID,e)},__afterRender:function(){},__update:function(e){var t=this.__beforeRender(e),i=this.el.tagName.toLowerCase(),n=i==="input"||i==="button",s=this.__render(t),o=s.attributes,r,a,l=o.length,u=0;try{for(;u<l;u++){r=o[u];a=s.getAttributeNode(r.name);if(a&&(a.nodeValue||a.nodeValue==="")&&!(n&&r.name.toLowerCase()==="type")){if(r.name==="class"){this.el.className=r.value}else{this.el.setAttribute(r.name,r.value)}}}}catch(e){SM.Error.log(e,"Error setting attribute: "+r.name+", value: "+r.name)}this.$el.html(s.innerHTML);this.__afterRender(t)},render:function(){this.__update.apply(this,arguments)},destroy:function(){this.clearBindings();if(this.__destroy){this.__destroy()}},bindModel:function(){var e,t,i,n;if(arguments.length<3){throw new Error("requires at least 3 arguments")}e=arguments[0];i=arguments[1];n=arguments[arguments.length-1];if(!$.isFunction(e.on)){throw new Error("the first argument was not a model")}if(typeof i!=="string"){throw new Error("the second argument was not an event string")}if(!$.isFunction(n)){throw new Error("the last argument was not a callback function")}t=Array.prototype.slice.call(arguments,0);t[1]=t[1]+"."+this.__NAME+this.__uid;e.on.apply(e,t.slice(1));this.__bindings.push(t)},unbindModel:function(){var e,t,i;if(arguments.length<2){throw new Error("requires at least 2 arguments")}e=arguments[0];i=arguments[1];if(arguments.length>2){t=arguments[arguments.length-1]}if(!$.isFunction(e.on)){throw new Error("the first argument was not a model")}if(typeof i!=="string"){throw new Error("the second argument was not an event string")}if(t&&!$.isFunction(t)){throw new Error("the last argument was not a callback function")}this.__removeBinding(e,i,t)},clearBindings:function(){if(this.__bindings.length){$.each(this.__bindings,function(e,t){var i=t[0],n=t[1],s=t[t.length-1];i.off(n,s)});this.__bindings=[]}},__removeBinding:function(e,t,i){var n=t+"."+this.__NAME+this.__uid,s=this.__bindings,o,r=0,a,l,u;for(;r<s.length;r++){o=s[r];l=o[0];a=o[1];u=o[o.length-1];if(l===e&&a===n){if(i){if(i===u){l.off(a,u);s.splice(r,1);r--}}else{l.off(a);s.splice(r,1);r--}}}}});SM.Views={register:function(e){if(!e.__NAME){throw new Error("the __NAME property must be defined")}if(!e.__templateID){throw new Error("the __templateID property must be defined")}e=SM.Object.extend(SM.View,e);e.__counter=0;return e},extend:function(e,t){var i=SM.Object.extend(e,t);return this.register(i)},deepExtend:function(e,t){var i=SM.Object.deepExtend(e,t);return this.register(i)},create:function(e,t){var i,n;if(e.__counter===0&&e.__setup){e.__setup()}i=SM.Object.create(e);if(t&&t.templateID){i.__templateID=t.templateID}i.__bindings=[];i.__initSettings(t);t=t||{};if(t.model){if(e.__model===undefined){throw new Error("SM.Views.create: if model option is given your view must define a __model property")}i[e.__model]=t.model}i.__uid=e.__counter++;if(typeof i.__create==="function"){i.__create(t)}n=i.__beforeRender(t);i.el=i.__render(n);i.$el=$(i.el);i.__afterRender(n);i.$el.attr("view-role",e.__NAME);$.data(i.el,e.__NAME,i);if(e.__init){i.__init(t)}i.$el.on("remove",{self:this},function(){i.destroy()});return i}};if(typeof module==="object"&&module.exports){module.exports.View=SM.View;module.exports.Views=SM.Views}SM.DialogView=SM.Views.deepExtend({__NAME:"dialog",__templateID:"dialog-template",__defaults:{isModal:false,isFixed:true,noOverlay:false,width:350,position:{my:"center",at:"center",collision:"none"},fixedPosition:null,easyClose:true,closeBtn:true},_hasShownOnce:false,__afterRender:function(){var e;this.$el.css("width",this.__settings.width);if(this.__settings.title){this.$el.attr("title",this.__settings.title)}e=this.$el.attr("title");if(e){this._addTitlebar(e);this.$el.removeAttr("title")}if(this.__settings.closeBtn){this._addCloseBtn()}if(this._hasShownOnce){this.$el.addClass("open");this.$el.removeClass("close")}else{this.$el.addClass("close");this.$el.removeClass("open")}},__onBeforeOpen:function(){$(window).on(SM.Event.RESIZE+"."+this.__NAME+this.__uid,{self:this},this._onResize);this.subscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.on("click",".dialog-close-btn",{self:this},this._onCloseClick)},__onAfterOpen:function(){},__onBeforeClose:function(){$(window).off(SM.Event.RESIZE+"."+this.__NAME+this.__uid,this._onResize);this.unsubscribe(SM.Event.KEYDOWN,this._onOpenKeydown);this.$el.off("click",this._onCloseClick)},__onAfterClose:function(){},__onWindowResize:function(){if(!this.__settings.noOverlay){this.position()}},open:function(e){if(this._isOpen){return this}if(e){SM.Object.update(this.__settings,e)}this.trigger("beforeOpen");this.__onBeforeOpen();this._open();return this},update:function(e){if(e.title){this._updateTitlebar(e.title)}},close:function(){var e=$.Event("beforeClose",{dialog:this});if(!this._isOpen){return this}this.trigger(e);if(e.isDefaultPrevented()){return this}this.__onBeforeClose();this._close();return this},position:function(){var e;if(!this.__settings.position.of){this.__settings.position.of=window}e=$.migrationFixPosition({my:this.__settings.position.my,at:this.__settings.position.at,of:this.__settings.position.of,offset:this.__settings.position.offset,within:this.__settings.position.within,collision:this.__settings.position.collision});this.$el.position(e);this.trigger("position")},isOpen:function(){return this._isOpen},_$overlay:null,_isOpen:false,_open:function(){var e,t,i=this;e=SM.Template.renderHTML("dialog-container-template");this._$dialogContainer=$(e);this._$dialogContainer.appendTo(document.body);if(!this.__settings.noOverlay){t=SM.Template.renderHTML("dialog-overlay-template",{isModal:this.__settings.isModal});this._$overlay=$(t);if(this.$el.hasClass("dialog-b")){this._$overlay.addClass("dialog-overlay-b")}this._$overlay.appendTo(this._$dialogContainer);if(this.__settings.easyClose){this._$overlay.on("click",{self:this},i._onOverlayClick)}}else{this._$dialogContainer.addClass("no-overlay")}if(this.__settings.isModal&&this.__settings.isFixed){$("body").addClass("sm-fixed-dialog-modal")}this.$el.appendTo(this._$dialogContainer);setTimeout(function(){i._fadeIn()},0)},_close:function(){var e=this;if(this._$overlay){this._$overlay.removeClass("open")}this.$el.removeClass("open");this.$el.addClass("close");this._isOpen=false;this._hasShownOnce=false;if(this.__settings.isModal){$("body").removeClass("sm-fixed-dialog-modal")}setTimeout(function(){e._fadeOutComplete()},100)},_fadeIn:function(){if(this._$overlay){this._$overlay.addClass("open")}this.$el.addClass("open");this.$el.removeClass("close");if(this.__settings.isFixed&&!this.__settings.isModal){this.$el.closest(".dialog-container").addClass("fixed-dialog")}if(!this.__settings.noOverlay){this.position()}else if(this.__settings.fixedPosition){this._$dialogContainer.css(this.__settings.fixedPosition)}this._isOpen=true;this._hasShownOnce=true;this.trigger("afterOpen");this.__onAfterOpen()},_fadeOutComplete:function(){if(this._$overlay){this._$overlay.off("click");this._$overlay.remove();this._$overlay=null}this.$el.detach();this.trigger("afterClose");this._$dialogContainer.remove();this._$dialogContainer=null;this.__onAfterClose()},_addCloseBtn:function(){var e,t=this.$el.hasClass("dialog-b")?"dialog-close-btn-template-b":"dialog-close-btn-template";e=SM.Template.renderHTML(t);this.$el.prepend(e)},_updateTitlebar:function(e){this.$el.find(".dialog-title-bar").replaceWith(SM.Template.renderHTML("dialog-title-bar-template",{title:e}))},_addTitlebar:function(e){var t=SM.Template.renderHTML("dialog-title-bar-template",{title:e});this.$el.prepend(t)},_onCloseClick:function(e){e.data.self.close();e.preventDefault()},_onOverlayClick:function(e){e.data.self.close()},_onResize:function(e,t){var i=e.data.self;i.__onWindowResize(e,t)},_onOpenKeydown:function(e){var t=e.data.self;if(e.which===SM.KeyCodes.ESCAPE){t.close();e.preventDefault()}},_contains:function(e){return SM.DOM.contains(this.el,e)}});SM.Date={getDaysInMonth:function(e,t){return 32-new Date(t,e,32).getDate()},getSimpleDate:function(e){if(!e){return{}}return{month:e.getMonth(),year:e.getFullYear(),day:e.getDate()}},timestamp:function(){return(new Date).getTime()},toISOString:function(e){var t=function(e){return e<10?"0"+e:e};if(!Date.prototype.toISOString){return[this.getUTCFullYear(),"-",t(this.getUTCMonth()+1),"-",t(this.getUTCDate()),"T",t(this.getUTCHours()),":",t(this.getUTCMinutes()),":",t(this.getUTCSeconds()),"Z"].join("")}return e.toISOString()},stdTimezoneOffset:function(){var e=new Date,t=e.getFullYear(),i=new Date(t,0,1),n=new Date(t,6,1);return Math.max(i.getTimezoneOffset(),n.getTimezoneOffset())},utcOffset:function(){return(new Date).getTimezoneOffset()*-6e4},toAge:function(e){var t,i,n,s,o,r,a,l;o=Math.floor(e/1e3);t=o%60;r=Math.floor(o/60);i=r%60;a=Math.floor(r/60);n=a%24;l=Math.floor(a/24);s=l%365;return{seconds:t,minutes:i,hours:n,days:s}},ageToMilliseconds:function(e){var t=e.split(" "),i=0,n,s,o,r=0;for(;i<t.length;i++){n=t[i];s=parseInt(n,10);o=n.charAt(n.length-1);o=this._millisecondMap[o];if(o){r+=s*o}}return r},formatDigitalTime:function(e,t,i){var n="";n=this._addDigitalTimeString(n,e)+":";n=this._addDigitalTimeString(n,t)+":";return this._addDigitalTimeString(n,i)},_millisecondMap:{s:1e3,m:1e3*60,h:1e3*60*60,d:1e3*60*60*24,o:1e3*60*60*24*30,y:1e3*60*60*24*365},_addDigitalTimeString:function(e,t){if(t>9){e=e+t}else if(t>0){e=e+"0"+t}else{e=e+"00"}return e}};SM.Cookies={get:function(e){var t=this.getAll();return t[e]},set:function(e,t,i,n){var s,o;n=SM.Object.extend({path:"/"},n);if(typeof i==="string"){o=SM.Date.ageToMilliseconds(i)}else{o=i}s=new Date;s.setTime(s.getTime()+o);i=s.toGMTString();document.cookie=[e+"="+t,"expires="+i,"path="+n.path].join("; ");return this},remove:function(e,t){t=SM.Object.extend({path:"/"},t);return this.set(e,"","-1s",t)},getAll:function(){var e={},t,i=document.cookie.split(";");$.each(i,function(i,n){n=$.trim(n);t=n.split("=");if(t.length===2){e[t[0]]=t[1]}});return e}};$(function(){var e=function(){return $("[data-sm-is-mobile]").css("display")=="none"};var t=function(){if(e()){return{my:"top",at:"top",of:window,collision:"none"}}else{return{my:"top+25",at:"top",of:window,collision:"none"}}};var i=SM.Views.create(SM.DialogView,{templateID:"report-problem-template",isModal:true,width:480,position:t(),easyClose:true,closeBtn:true});var n=false;i.$el.on("dialog.afterOpen",function(t){$("[data-sm-checkbox]").checkbox();l();$(".report-problem-btn").addClass("invisible");$(".dialog-overlay").addClass("report-problem-dialog-overlay");if(!n){n=true;o()}if(e()){var i={my:"top",at:"bottom",of:window,collision:"none",using:function(e){$(this).css(e)}};$(".report-problem-dialog").position(i);var s={my:"top",at:"top",of:window,collision:"none",using:function(e){$(this).animate(e,400,"linear")}};$(".report-problem-dialog").position(s)}}).on("dialog.afterClose",function(e){$(".report-problem-btn").removeClass("invisible");$(".dialog-overlay").removeClass("report-problem-dialog-overlay")});function s(){$(".report-problem-dialog").position({my:"top",at:"top",of:window,collision:"none"})}function o(){var e=$("#report_problem_form");e.submit(function(t){$(".report-problem-submit-button").prop("disabled",true);$.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serialize(),success:function(e){r();a(e)},dataType:"json"});t.preventDefault()})}function r(){if(e()){$(".report-problem-body").hide()}else{$(".report-problem-body").css("visibility","hidden")}$(".report-problem-submit-actions").hide();$(".report-problem-close-actions").show()}function a(e){var t=e["redirect_url"]||null;if(t){window.location.replace(t)}}function l(){var e=$(".report-problem-submit-button");var t=$(".checkbox-button-container[data-sm-checkbox]");function i(){if($(".report-problem-checkbox-button-input:checked").length>0){e.prop("disabled",false)}else{e.prop("disabled",true)}}if(SM.Touch.isTouchDevice()){t.on("touchend","label",i)}else{t.on("change",".report-problem-checkbox-button-input",i)}}function u(){$.ajax({method:"POST",url:$("#report_problem_trigger_form").attr("action"),data:$("#report_problem_trigger_form").serializeArray()})}$(window).on("orientationchange",s);$(".report-problem-trigger").on("click",function(e){i.open();u()})});